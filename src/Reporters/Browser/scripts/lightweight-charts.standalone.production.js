/*!
 * @license
 * TradingView Lightweight Charts v1.1.0-dev+202001201138
 * Copyright (c) 2019 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function n(t,i,n,h,r,u){isFinite(i)&&isFinite(h)&&isFinite(n)&&isFinite(r)&&(t.save(),s(t,u),t.beginPath(),t.moveTo(i,n),t.lineTo(h,r),t.stroke(),t.restore())}function s(t,i){var n,s=((n={})[0]=[],n[1]=[t.lineWidth,2*t.lineWidth],n[2]=[5*t.lineWidth,6*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(s)}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));var h=function(t,i){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(t,i)};function r(t,i){function n(){this.constructor=t}h(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t}).apply(this,arguments)};function e(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function o(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function a(t){return f(o(t))}function c(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=0,h=i;s<h.length;s++){var r=h[s];for(var u in r)void 0!==r[u]&&("object"!=typeof r[u]||void 0===t[u]?t[u]=r[u]:c(t[u],r[u]))}return t}function l(t){return"number"==typeof t&&isFinite(t)}function v(t){return"number"==typeof t&&t%1==0}function d(t){return"string"==typeof t}function w(t){return!(t<=0||t>0)}function b(t){var i,n,s,h=t;if(!h||"object"!=typeof h)return h;for(n in i=Array.isArray(h)?[]:{},h)h.hasOwnProperty(n)&&(s=h[n],i[n]=s&&"object"==typeof s?b(s):s);return i}function m(t){return null!==t}function g(t){return null===t?void 0:t}var M=function(){function t(){this.t=[]}return t.prototype.setRenderers=function(t){this.t=t},t.prototype.draw=function(t,i){this.t.forEach((function(n){t.save(),n.draw(t,i),t.restore()}))},t}(),p=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&null!==this._data.visibleRange){var i=this._data.visibleRange,n=this._data,s=function(s){t.beginPath();for(var h=i.to-1;h>=i.from;--h){var r=n.items[h];t.moveTo(r.x,r.y),t.arc(r.x,r.y,s,0,2*Math.PI)}t.fill()};t.fillStyle=n.backColor,s(n.radius+2),t.fillStyle=n.lineColor,s(n.radius)}},t}();var y,k,N,S,x={from:0,to:1},C=function(){function t(t,i){this.i=new M,this.s=[],this.u=[],this.o=!0,this.l=t,this.v=i,this.i.setRenderers(this.s)}return t.prototype.update=function(t){var i=this,n=this.l.serieses();n.length!==this.s.length&&(this.u=n.map((function(){return{items:[{x:0,y:0,time:0,price:0}],lineColor:"",backColor:i.l.options().layout.backgroundColor,radius:0,visibleRange:null}})),this.s=this.u.map((function(t){var i=new p;return i.setData(t),i})),this.i.setRenderers(this.s)),this.o=!0},t.prototype.renderer=function(t,i,n){return this.o&&(this.m(),this.o=!1),this.i},t.prototype.m=function(){var t=this,i=this.l.serieses(),n=this.v.appliedIndex(),s=this.l.timeScale();i.forEach((function(i,h){var r=t.u[h],u=i.markerDataAtIndex(n);if(null!==u){var e=f(i.firstValue());r.lineColor=i.barColorer().barStyle(n).barColor,r.backColor=t.l.options().layout.backgroundColor,r.radius=u.radius,r.items[0].price=u.price,r.items[0].y=i.priceScale().priceToCoordinate(u.price,e.value),r.items[0].time=n,r.items[0].x=s.indexToCoordinate(n),r.visibleRange=x}else r.visibleRange=null}))},t}(),D=function(){function t(t){this.g=t}return t.prototype.draw=function(t){if(null!==this.g){var i=this.g.vertLine.visible,s=this.g.horzLine.visible;if(i||s){var h=this.g.vertLine.lineWidth%2==0?.5:0,r=this.g.horzLine.lineWidth%2==0?.5:0,u=this.g.x+1+r,e=this.g.y+h,o=this.g.w,f=this.g.h;i&&u>=0&&(t.lineWidth=this.g.vertLine.lineWidth,t.strokeStyle=this.g.vertLine.color,t.fillStyle=this.g.vertLine.color,n(t,u,0,u,f,this.g.vertLine.lineStyle)),s&&e>=0&&(t.lineWidth=this.g.horzLine.lineWidth,t.strokeStyle=this.g.horzLine.color,t.fillStyle=this.g.horzLine.color,n(t,0,e,o,e,this.g.horzLine.lineStyle))}}},t}(),O=function(){function t(t){this.o=!0,this.M={vertLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},horzLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},w:0,h:0,x:0,y:0},this.p=new D(this.M),this.k=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){return this.o&&this.m(),this.p},t.prototype.m=function(){var t=this.k.visible(),i=f(this.k.pane()),n=i.model().options().crosshair,s=this.M;s.horzLine.visible=t&&this.k.horzLineVisible(i),s.vertLine.visible=t&&this.k.vertLineVisible(),s.horzLine.lineWidth=n.horzLine.width,s.horzLine.lineStyle=n.horzLine.style,s.horzLine.color=n.horzLine.color,s.vertLine.lineWidth=n.vertLine.width,s.vertLine.lineStyle=n.vertLine.style,s.vertLine.color=n.vertLine.color,s.w=i.width(),s.h=i.height(),s.x=this.k.appliedX(),s.y=this.k.appliedY()},t}(),E={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",feldspar:"#d19275",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslateblue:"#8470ff",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",violetred:"#d02090",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function T(t){return function(t,i,n){return w(i)?t:i<t?t:i>n?n:Math.round(i)}(0,t,255)}function L(t){return function(t,i,n){return w(i)?t:i<t?t:i>n?n:Math.round(1e4*i)/1e4}(0,t,1)}function A(t){(t=t.toLowerCase())in E&&(t=E[t]);var i,n,s=(i=t,null!==(n=N.re.exec(i))?N.parse(n):null);if(null!==s)return s;var h=function(t){var i=k.re.exec(t);return null!==i?k.parse(i):null}(t);if(null!==h)return h;var r=function(t){var i=y.re.exec(t);return null!==i?y.parse(i):null}(t);if(null!==r)return r;var u=function(t){var i=S.re.exec(t);return null!==i?S.parse(i):null}(t);return null!==u?[u[0],u[1],u[2]]:null}function B(t){var i=A(t);if(null!==i)return i;throw new Error("Passed color string "+t+" does not match any of the known color representations")}function z(t,i){if(i<0||i>255)throw new Error("invalid threshold value, valid values are [0, 255]");return function(t){return.199*t[0]+.687*t[1]+.114*t[2]}(t)>=i?"white":"black"}function V(t){return function(t){return 0===t.indexOf("#")}(t)?t:(n=B(t),s=1,"rgba("+(i=[n[0],n[1],n[2],L(s)])[0]+", "+i[1]+", "+i[2]+", "+i[3]+")");var i,n,s}function j(t){return"black"===z(B(t),160)?"white":"black"}!function(t){t.re=/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,t.parse=function(t){return[T(parseInt(t[1]+t[1],16)),T(parseInt(t[2]+t[2],16)),T(parseInt(t[3]+t[3],16))]}}(y||(y={})),function(t){t.re=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,t.parse=function(t){return[T(parseInt(t[1],16)),T(parseInt(t[2],16)),T(parseInt(t[3],16))]}}(k||(k={})),function(t){t.re=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,t.parse=function(t){return[T(parseInt(t[1],10)),T(parseInt(t[2],10)),T(parseInt(t[3],10))]}}(N||(N={})),function(t){t.re=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/,t.parse=function(t){return[T(parseInt(t[1],10)),T(parseInt(t[2],10)),T(parseInt(t[3],10)),L(parseFloat(t[4]))]}}(S||(S={}));var F=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.g=t,this.N=i},t.prototype.draw=function(t,i,n,s,h){if(this.g.visible){var r=i.fontSize;t.font=i.font;var u=this.g.tickVisible?i.tickLength:0,e=this.g.borderVisible?i.borderSize:0,o=i.paddingTop,f=i.paddingBottom,a=i.paddingInner,c=i.paddingOuter,l=this.g.text,v=Math.ceil(n.measureText(t,l)),d=i.baselineOffset,w=i.fontSize+o+f,b=e+v+a+c+u,m=this.N.coordinate;this.N.fixedCoordinate&&(m=this.N.fixedCoordinate);var g,M,p=m-Math.floor(r/2)-o-.5,y=p+w,k="right"===h,N=k?s-e-.5:.5,S=N;t.fillStyle=V(this.N.background),t.lineWidth=1,t.lineCap="butt",l&&(k?(g=N-u,M=(S=N-b)+c):(S=N+b,g=N+u,M=N+e+u+a),t.beginPath(),t.moveTo(N,p),t.lineTo(S,p),t.lineTo(S,y),t.lineTo(N,y),t.fill(),this.g.tickVisible&&(t.beginPath(),t.strokeStyle=this.N.color,t.moveTo(N,m),t.lineTo(g,m),t.stroke()),t.textAlign="left",t.fillStyle=this.N.color,t.fillText(l,M,y-f-d))}},t.prototype.height=function(t,i){return this.g.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),I=function(){function t(t){this.S={coordinate:0,color:"#FFF",background:"#000"},this.C={text:"",visible:!1,tickVisible:!0,borderVisible:!0,lineStyle:1},this.D={text:"",visible:!1,tickVisible:!1,borderVisible:!1,lineStyle:1},this.o=!0,this.O=new(t||F)(this.C,this.S),this.T=new(t||F)(this.D,this.S)}return t.prototype.text=function(){return this.C.text},t.prototype.background=function(){return this.S.background},t.prototype.color=function(){return j(this.background())},t.prototype.coordinate=function(){return this.L(),this.S.coordinate},t.prototype.floatCoordinate=function(){return this.L(),this.S.floatCoordinate||this.S.coordinate},t.prototype.update=function(){this.o=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.O.height(t,i),this.T.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.S.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.S.fixedCoordinate=t},t.prototype.isVisible=function(){return this.L(),this.C.visible||this.D.visible},t.prototype.isAxisLabelVisible=function(){return this.L(),this.C.visible},t.prototype.isPaneLabelVisible=function(){return this.L(),this.D.visible},t.prototype.renderer=function(){return this.L(),this.O.setData(this.C,this.S),this.T.setData(this.D,this.S),this.O},t.prototype.paneRenderer=function(){return this.L(),this.O.setData(this.C,this.S),this.T.setData(this.D,this.S),this.T},t.prototype.L=function(){this.o&&(this._updateRendererData(this.C,this.D,this.S),this.o=!1)},t}(),P=function(t){function i(i,n,s){var h=t.call(this)||this;return h.k=i,h.A=n,h.B=s,h}return r(i,t),i.prototype._updateRendererData=function(t,i,n){t.visible=!1;var s=this.k.options().horzLine;if(s.labelVisible){var h=this.A.firstValue();if(this.k.visible()&&!this.A.isEmpty()&&null!==h){n.background=s.labelBackgroundColor,n.color=j(s.labelBackgroundColor);var r=this.B(this.A);n.coordinate=r.coordinate,t.text=this.A.formatPrice(r.price,h),t.visible=!0}}},i}(I),W=/[1-9]/g,R=function(){function t(){this.g=null}return t.prototype.setData=function(t){this.g=t},t.prototype.draw=function(t,i){if(null!==this.g&&!1!==this.g.visible&&0!==this.g.text.length){t.font=i.font;var n=Math.round(i.widthCache.measureText(t,this.g.text,W));if(!(n<=0)){var s=i.paddingHorizontal,h=n+2*s,r=h/2,u=this.g.width,e=this.g.coordinate,o=Math.floor(e-r)+.5;o<0?(e+=Math.abs(0-o),o=Math.floor(e-r)+.5):o+h>u&&(e-=Math.abs(u-(o+h)),o=Math.floor(e-r)+.5);var f=o+h,a=-.5+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.g.background,t.lineWidth=1,function(t,i,n,s,h,r){t.beginPath(),t.moveTo(i+r,n),t.lineTo(i+s-r,n),t.arcTo(i+s,n,i+s,n+r,r),t.lineTo(i+s,n+h-r),t.arcTo(i+s,n+h,i+s-r,n+h,r),t.lineTo(i+r,n+h),t.arcTo(i,n+h,i,n+h-r,r),t.lineTo(i,n+r),t.arcTo(i,n,i+r,n,r)}(t,o,-.5,f-o,a- -.5,1),t.fill();var c=Math.round(this.g.coordinate+1),l=-.5+i.borderSize+i.tickLength;t.strokeStyle=this.g.color,t.beginPath(),t.moveTo(c,-.5),t.lineTo(c,l),t.stroke();var v=a-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.g.color,t.fillText(this.g.text,o+s,v)}}},t}();var U,q=function(t){function i(i,n,s){var h=t.call(this)||this;return h.o=!0,h.p=new R,h.M={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},h.v=i,h.V=n,h.B=s,h}return r(i,t),i.prototype.update=function(){this.o=!0},i.prototype.renderer=function(){return this.o&&(this.m(),this.o=!1),this.p.setData(this.M),this.p},i.prototype.m=function(){var t=this.M;t.visible=!1;var i=this.v.options().vertLine;if(i.labelVisible){var n=this.V.timeScale();if(!n.isEmpty()){var s=n.indexToUserTime(this.v.appliedIndex());t.width=n.width();var h=this.B();h.time&&(t.coordinate=h.coordinate,t.text=n.formatDateTime(f(s)),t.visible=!0,t.background=i.labelBackgroundColor,t.color=j(i.labelBackgroundColor))}}},i}(function(){function t(){this._text="",this._background="#585858",this._coordinate=0}return t.prototype.text=function(){return this._text},t.prototype.background=function(){return this._background},t.prototype.color=function(){return"black"===z(B(this._background),150)?"white":"black"},t.prototype.coordinate=function(){return this._coordinate},t}()),H=function(){function t(){this._priceScale=null,this.j=0}return t.prototype.zorder=function(){return this.j},t.prototype.setZorder=function(t){this.j=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,i){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(U||(U={}));var Y=function(t){function i(i,n){var s=t.call(this)||this;s.F=null,s.I=NaN,s.P=0,s.W=!0,s.R=new Map,s.U=!1,s.q=NaN,s.H=NaN,s.Y=NaN,s.J=NaN,s.V=i,s.K=n,s.$=new C(i,s);var h,r;s.X=(h=function(){return s.I},r=function(){return s.H},function(t){var i=r(),n=h();if(t===f(s.F).defaultPriceScale())return{price:n,coordinate:i};var u=f(t.firstValue());return{price:t.coordinateToPrice(i,u),coordinate:i}});var u=function(t,i){return function(){return{time:s.V.timeScale().indexToUserTime(t()),coordinate:i()}}}((function(){return s.P}),(function(){return s.appliedX()}));return s._=new q(s,i,u),s.Z=new O(s),s}return r(i,t),i.prototype.index=function(){return this.P},i.prototype.options=function(){return this.K},i.prototype.saveOriginCoord=function(t,i){this.Y=t,this.J=i},i.prototype.clearOriginCoord=function(){this.Y=NaN,this.J=NaN},i.prototype.originCoordX=function(){return this.Y},i.prototype.originCoordY=function(){return this.J},i.prototype.setPosition=function(t,i,n){this.U||(this.U=!0),this.W=!0,this.G(t,i,n)},i.prototype.appliedIndex=function(){return this.P},i.prototype.appliedX=function(){return this.q},i.prototype.appliedY=function(){return this.H},i.prototype.visible=function(){return this.W},i.prototype.clearPosition=function(){this.W=!1,this.tt(),this.I=NaN,this.q=NaN,this.H=NaN,this.F=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.F?[this.Z,this.$]:[]},i.prototype.horzLineVisible=function(t){return t===this.F&&this.K.horzLine.visible},i.prototype.vertLineVisible=function(){return this.K.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.W&&this.F===t||this.R.clear();var n=[];return this.F===t&&n.push(this.it(this.R,i,this.X)),n},i.prototype.timeAxisViews=function(){return this.W?[this._]:[]},i.prototype.pane=function(){return this.F},i.prototype.updateAllViews=function(){this.R.forEach((function(t){return t.update()})),this._.update(),this.$.update()},i.prototype.nt=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.G=function(t,i,n){this.st(t,i,n)&&this.updateAllViews()},i.prototype.st=function(t,i,n){var s=this.q,h=this.H,r=this.I,u=this.P,e=this.F,o=this.nt(n);this.P=t,this.q=isNaN(t)?NaN:this.V.timeScale().indexToCoordinate(t);var f=null!==o?o.firstValue():null;return null!==o&&null!==f?(this.F=n,this.I=i,this.H=o.priceToCoordinate(i,f)):(this.F=null,this.I=NaN,this.H=NaN),s!==this.q||h!==this.H||u!==this.P||r!==this.I||e!==this.F},i.prototype.tt=function(){var t=this.V.serieses().map((function(t){return t.bars().lastIndex()})).filter(m),i=0===t.length?null:Math.max.apply(Math,t);this.P=null!==i?i:NaN},i.prototype.it=function(t,i,n){var s=t.get(i);return void 0===s&&(s=new P(this,i,n),t.set(i,s)),s},i}(H),J=".",K="'";function $(t,i){if(!l(t))return"n/a";if(!v(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var X,_=function(){function t(t,i,n,s){if(i||(i=1),l(t)&&v(t)||(t=100),t<0)throw new TypeError("invalid base");this.A=t,this.ht=i,this.rt=s,n&&void 0!==s&&s>0&&2!==s&&4!==s&&8!==s||(this.ut=n,this.et())}return t.prototype.format=function(t){var i=t<0?"âˆ’":"";return t=Math.abs(t),this.ut?i+this.ot(t):i+this.ft(t)},t.prototype.et=function(){if(this._fractionalLength=0,this.A>0&&this.ht>0){var t=this.A;for(this.ut&&this.rt&&(t/=this.rt);t>1;)t/=10,this._fractionalLength++}},t.prototype.ft=function(t){var i;i=this.ut?Math.pow(10,this._fractionalLength||0):this.A/this.ht;var n=Math.floor(t),s="",h=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this._fractionalLength);r>=i&&(r-=i,n+=1),s=J+$(+r.toFixed(this._fractionalLength)*this.ht,h)}else n=Math.round(n*i)/i,h>0&&(s=J+$(0,h));return n.toFixed(0)+s},t.prototype.ot=function(t){var i=this.A/this.ht,n=Math.floor(t),s=Math.round(t*i)-n*i;if(s===i&&(s=0,n+=1),!this._fractionalLength)throw new Error("_fractionalLength is not calculated");var h="";if(this.rt){var r=s%this.rt,u=$(s=(s-r)/this.rt,this._fractionalLength),e=2===this.rt?["0","5"][r]:8===this.rt?["0","1","2","3","4","5","6","7"][r]:["0","2","5","7"][r];h=u+K+e}else h=$(s*this.ht,this._fractionalLength);return n.toString()+K+h},t}(),Z=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return r(i,t),i.prototype.format=function(i){return t.prototype.format.call(this,i)+"%"},i}(_),G=function(){function t(){this.at=[]}return t.prototype.subscribe=function(t,i,n){var s={callback:t,linkedObject:i,singleshot:!0===n};this.at.push(s)},t.prototype.unsubscribe=function(t){var i=this.at.findIndex((function(i){return t===i.callback}));i>-1&&this.at.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.at=this.at.filter((function(i){return i.linkedObject===t}))},t.prototype.fire=function(t,i){var n=this.at.slice();this.at=this.at.filter((function(t){return!t.singleshot})),n.forEach((function(n){return n.callback(t,i)}))},t.prototype.hasListeners=function(){return this.at.length>0},t.prototype.destroy=function(){this.at=[]},t}(),Q=function(t){function i(i){var n=t.call(this)||this;return n.V=i,n}return r(i,t),i.prototype.model=function(){return this.V},i.prototype.minMove=function(){return 0},i.prototype.autoscaleInfo=function(t,i){return null},i}(H),tt=function(){function t(t,i){this.ct=t,this.lt=i}return t.prototype.equals=function(t){return null!==t&&(this.ct===t.ct&&this.lt===t.lt)},t.prototype.clone=function(){return new t(this.ct,this.lt)},t.prototype.minValue=function(){return this.ct},t.prototype.setMinValue=function(t){this.ct=t},t.prototype.maxValue=function(){return this.lt},t.prototype.setMaxValue=function(t){this.lt=t},t.prototype.length=function(){return this.lt-this.ct},t.prototype.isEmpty=function(){return this.lt===this.ct||Number.isNaN(this.lt)||Number.isNaN(this.ct)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.apply=function(t,i){this.ct=Math.min(this.ct,t),this.lt=Math.max(this.lt,i)},t.prototype.set=function(t,i){this.ct=t,this.lt=i},t.prototype.scaleAroundCenter=function(t){if(l(t)&&0!==this.lt-this.ct){var i=.5*(this.lt+this.ct),n=this.lt-i,s=this.ct-i;n*=t,s*=t,this.lt=i+n,this.ct=i+s}},t.prototype.shift=function(t){l(t)&&(this.lt+=t,this.ct+=t)},t.prototype.containsStrictly=function(t){return t.minValue()>this.ct&&t.maxValue()<this.lt},t}();function it(t,i,n){return Math.min(Math.max(t,i),n)}function nt(t,i,n){return i-t<=n}function st(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function ht(t,i){var n=100*(t-i)/i;return i<0?-n:n}function rt(t,i){var n=ht(t.minValue(),i),s=ht(t.maxValue(),i);return new tt(n,s)}function ut(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function et(t,i){var n=ut(t.minValue(),i),s=ut(t.maxValue(),i);return new tt(n,s)}function ot(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=st(i+1e-4)+4;return t<0?-n:n}function ft(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=Math.pow(10,i-4)-1e-4;return t<0?-n:n}function at(t){if(null===t)return null;var i=ot(t.minValue()),n=ot(t.maxValue());return new tt(i,n)}!function(t){t[t.LogicalOffset=4]="LogicalOffset",t[t.CoordOffset=1e-4]="CoordOffset"}(X||(X={}));var ct=function(){function t(t,i){if(this.vt=t,this.dt=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.vt))this.wt=[2,2.5,2];else{this.wt=[];for(var n=this.vt;1!==n;){if(n%2==0)this.wt.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.wt.push(2),this.wt.push(2.5),n/=5}if(this.wt.length>100)throw new Error("something wrong with base")}}}return t.prototype.tickSpan=function(t,i,n){for(var s,h,r,u=0===this.vt?0:1/this.vt,e=Math.pow(10,Math.max(0,Math.ceil(st(t-i)))),o=0,f=this.dt[0];;){var a=nt(e,u,1e-9)&&e>u+1e-9,c=nt(e,n*f,1e-9),l=nt(e,1,1e-9);if(!(a&&c&&l))break;e/=f,f=this.dt[++o%this.dt.length]}if(e<=u+1e-9&&(e=u),e=Math.max(1,e),this.wt.length>0&&(s=e,h=1,r=1e-9,Math.abs(s-h)<r))for(o=0,f=this.wt[0];nt(e,n*f,1e-9)&&e>u+1e-9;)e/=f,f=this.wt[++o%this.wt.length];return e},t}(),lt=function(){function t(t,i,n,s){this.bt=[],this.A=t,this.vt=i,this.gt=n,this.Mt=s}return t.prototype.setBase=function(t){if(t<0)throw new Error("base < 0");this.vt=t},t.prototype.tickSpan=function(t,i){if(t<i)throw new Error("high < low");var n=this.A.height(),s=(t-i)*this.pt()/n,h=new ct(this.vt,[2,2.5,2]),r=new ct(this.vt,[2,2,2.5]),u=new ct(this.vt,[2.5,2,2]),e=[];return e.push(h.tickSpan(t,i,s)),e.push(r.tickSpan(t,i,s)),e.push(u.tickSpan(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(e)},t.prototype.rebuildTickMarks=function(){var t=this.A,i=t.firstValue();if(null!==i){var n=t.height(),s=this.gt(n-1,i),h=this.gt(0,i),r=this.A.options().entireTextOnly?this.yt()/2:0,u=r,e=n-1-r,o=Math.max(s,h),f=Math.min(s,h);if(o!==f){for(var a=this.tickSpan(o,f),c=o%a,l=o>=f?1:-1,v=null,d=0,w=o-(c+=c<0?a:0);w>f;w-=a){var b=this.Mt(w,i,!0);null!==v&&Math.abs(b-v)<this.pt()||(b<u||b>e||(d<this.bt.length?(this.bt[d].coord=Math.round(b),this.bt[d].label=t.formatLogical(w)):this.bt.push({coord:Math.round(b),label:t.formatLogical(w)}),d++,v=b,t.isLog()&&(a=this.tickSpan(w*l,f))))}this.bt.length=d}else this.bt=[]}else this.bt=[]},t.prototype.marks=function(){return this.bt},t.prototype.yt=function(){return this.A.fontSize()},t.prototype.pt=function(){return Math.ceil(2.5*this.yt())},t}(),vt=function(){function t(t){this.kt=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.Nt(t):t<999995?i+this.Nt(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.Nt(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.Nt(t/1e9)+"B")},t.prototype.Nt=function(t){var i=Math.pow(10,this.kt);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.kt).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function dt(t,i,n,s){if(0!==i.length){var h=i[s.from].x,r=i[s.from].y;t.moveTo(h,r);for(var u=s.from+1;u<s.to;++u){var e=i[u];if(1===n){var o=i[u-1].x,f=e.x;t.lineTo(o,f)}t.lineTo(e.x,e.y)}}}var wt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){var i=Math.min(this._data.bottom,this._data.zeroLine);t.save(),t.lineCap="square",t.strokeStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,s(t,this._data.lineStyle),t.lineWidth=1,t.beginPath(),t.moveTo(this._data.items[this._data.visibleRange.from].x,i),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.items[this._data.visibleRange.from].y),dt(t,this._data.items,this._data.lineType,this._data.visibleRange),t.lineTo(this._data.items[this._data.visibleRange.to-1].x,i),t.lineTo(this._data.items[this._data.visibleRange.from].x,i),t.closePath();var n=t.createLinearGradient(0,0,0,i);n.addColorStop(0,this._data.topColor),n.addColorStop(1,this._data.bottomColor),t.fillStyle=n,t.fill(),t.restore()}},t}(),bt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange&&(t.lineCap="square",t.lineWidth=this._data.lineWidth,s(t,this._data.lineStyle),t.strokeStyle=this._data.lineColor,t.lineJoin="miter",t.beginPath(),dt(t,this._data.items,this._data.lineType,this._data.visibleRange),t.stroke())},t}();function mt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var u=r>>1,e=s+u;n(t[e],i)?(s=e+1,r-=u+1):r=u}return s}function gt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var u=r>>1,e=s+u;n(i,t[e])?r=u:(s=e+1,r-=u+1)}return s}function Mt(t,i){return t.time<i}function pt(t,i){return t<i.time}function yt(t,i,n){var s=i.firstBar(),h=i.lastBar(),r=mt(t,s,Mt),u=gt(t,h,pt);if(!n)return{from:r,to:u};var e=r,o=u;return r>0&&r<t.length&&t[r].time>=s&&(e=r-1),u>0&&u<t.length&&t[u-1].time<=h&&(o=u+1),{from:e,to:o}}var kt=function(){function t(t,i,n){this._invalidated=!0,this._dataInvalidated=!0,this._items=[],this._itemsVisibleRange=null,this._series=t,this._model=i,this.St=n}return t.prototype.update=function(t){this._invalidated=!0,"data"===t&&(this._dataInvalidated=!0)},t.prototype._makeValid=function(){this._dataInvalidated&&(this._fillRawPoints(),this._dataInvalidated=!1),this._invalidated&&(this._updatePoints(),this._invalidated=!1)},t.prototype._clearVisibleRange=function(){this._itemsVisibleRange=null},t.prototype._updatePoints=function(){var t=this._series.priceScale(),i=this._model.timeScale();if(this._clearVisibleRange(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleBars();if(null!==n&&0!==this._series.data().bars().size()){var s=this._series.firstValue();null!==s&&(this._itemsVisibleRange=yt(this._items,n,this.St),this._convertToCoordinates(t,i,s.value))}}},t}(),Nt=function(t){function i(i,n){var s=t.call(this,i,n,!0)||this;return s._itemsZeroLine=NaN,s}return r(i,t),i.prototype._convertToCoordinates=function(t,i,n){i.indexesToCoordinates(this._items,g(this._itemsVisibleRange)),this._itemsZeroLine=t.pointsArrayToCoordinates(this._items,n,g(this._itemsVisibleRange))},i.prototype._createRawItemBase=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype._fillRawPoints=function(){var t=this,i=this._series.barFunction(),n=[],s=this._series.barColorer();this._series.bars().each((function(h,r){var u=i(r.plot),e=t._createRawItem(h,u,s);return n.push(e),!1})),this._items=n},i}(kt),St=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.p=new M,s.xt=new wt,s.Ct=new bt,s.p.setRenderers([s.xt,s.Ct]),s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={lineType:0,items:this._items,lineColor:n.lineColor,lineStyle:n.lineStyle,lineWidth:n.lineWidth,topColor:n.topColor,bottomColor:n.bottomColor,bottom:t,zeroLine:this._itemsZeroLine,visibleRange:this._itemsVisibleRange};return this.xt.setData(s),this.Ct.setData(s),this.p},i.prototype._createRawItem=function(t,i){return this._createRawItemBase(t,i)},i}(Nt);function xt(t){return.3*t}var Ct,Dt=function(){function t(){this.g=null,this.Dt=0,this.Ot=0}return t.prototype.setData=function(t){this.g=t,this.Dt=xt(t.barSpacing),this.Ot=t.thinBars?1:Math.max(1,Math.round(this.Dt))},t.prototype.draw=function(t){if(null!==this.g&&0!==this.g.bars.length&&null!==this.g.visibleRange){t.save(),t.translate(.5,.5);for(var i=this.g.thinBars?1:Math.round(this.Dt),n=this.g.thinBars?1:i/2,s=null,h=this.g.visibleRange.from;h<this.g.visibleRange.to;++h){var r=this.g.bars[h];s!==r.color&&(t.fillStyle=r.color,s=r.color),t.fillRect(Math.round(r.x-this.Ot/2),Math.round(r.highY-n),Math.round(this.Ot),Math.round(r.lowY-r.highY+i)),this.Ot<this.g.barSpacing-1&&(this.g.openVisible&&t.fillRect(Math.round(r.x-1.5*this.Dt),Math.floor(r.openY-n),Math.round(1.5*this.Dt),i),t.fillRect(Math.round(r.x),Math.floor(r.closeY-n),Math.round(1.5*this.Dt),i))}t.restore()}},t}(),Ot=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return r(i,t),i.prototype._convertToCoordinates=function(t,i,n){i.indexesToCoordinates(this._items,g(this._itemsVisibleRange)),t.barPricesToCoordinates(this._items,n,g(this._itemsVisibleRange))},i.prototype._createDefaultItem=function(t,i,n){return{time:t,open:i.plot.value[0],high:i.plot.value[1],low:i.plot.value[2],close:i.plot.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype._fillRawPoints=function(){var t=this,i=[],n=this._series.barColorer();this._series.bars().each((function(s,h){var r=t._createRawItem(s,h,n);return i.push(r),!1})),this._items=i},i}(kt),Et=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.p=new Dt,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),openVisible:n.openVisible,thinBars:n.thinBars,visibleRange:this._itemsVisibleRange};return this.p.setData(s),this.p},i.prototype._createRawItem=function(t,i,n){return u({},this._createDefaultItem(t,i,n),{color:n.barStyle(t).barColor,glyphs:i.plot.glyphs})},i}(Ot);!function(t){t[t.BarBorderWidth=1]="BarBorderWidth"}(Ct||(Ct={}));var Tt=function(){function t(){this.g=null,this.Dt=0}return t.prototype.setData=function(t){this.g=t,this.Dt=xt(t.barSpacing)},t.prototype.draw=function(t){if(null!==this.g&&0!==this.g.bars.length&&null!==this.g.visibleRange)if(t.lineCap="square",this.g.barSpacing<1)this.Et(t);else{var i=this.g.bars;t.translate(-.5,-.5),t.lineWidth=1,this.g.wickVisible&&this.Tt(t,i,this.g.visibleRange),this.g.borderVisible&&this.Lt(t,i,this.g.visibleRange),this.At(t,i,this.g.visibleRange)}},t.prototype.Tt=function(t,i,n){for(var s="",h=n.from;h<n.to;h++){var r=i[h];r.wickColor!==s&&(t.fillStyle=r.wickColor,s=r.wickColor),t.fillRect(r.x,r.highY,1,r.lowY-r.highY)}},t.prototype.Lt=function(t,i,n){for(var s="",h=n.from;h<n.to;h++){var r=i[h];r.borderColor!==s&&(t.fillStyle=r.borderColor,s=r.borderColor);var u=Math.round(r.x-this.Dt),e=Math.round(r.x+this.Dt),o=Math.min(r.openY,r.closeY),f=Math.max(r.openY,r.closeY);t.fillRect(u,o,e-u+1,f-o+1)}},t.prototype.At=function(t,i,n){if(null!==this.g)for(var s="",h=n.from;h<n.to;h++){var r=i[h],u=Math.min(r.openY,r.closeY),e=Math.max(r.openY,r.closeY),o=Math.round(r.x-this.Dt),f=Math.round(r.x+this.Dt);if(this.g.borderVisible&&(o+=1,u+=1,f-=1,e-=1),!(u>e)){if(r.color!==s){var a=r.color;t.fillStyle=a,s=a}t.fillRect(o,u,f-o+1,e-u+1)}}},t.prototype.Et=function(t){if(null!==this.g&&null!==this.g.visibleRange){if(t.lineWidth=1,this.g.wickVisible){t.strokeStyle=this.g.wickColor,t.beginPath();for(var i=this.g.visibleRange.from;i<this.g.visibleRange.to;i++){var n=this.g.bars[i];t.moveTo(n.x,n.lowY),t.lineTo(n.x,n.highY)}t.stroke()}var s="",h=!1;t.beginPath();for(i=this.g.visibleRange.from;i<this.g.visibleRange.to;i++){s!==(n=this.g.bars[i]).color&&(h&&(t.stroke(),t.beginPath(),h=!1),t.strokeStyle=n.color,s=n.color),t.moveTo(n.x,n.openY),t.lineTo(n.x,n.closeY),h=!0}h&&t.stroke()}},t}(),Lt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.p=new Tt,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickColor:n.wickColor,wickVisible:n.wickVisible,borderVisible:n.borderVisible,visibleRange:this._itemsVisibleRange};return this.p.setData(s),this.p},i.prototype._createRawItem=function(t,i,n){var s=n.barStyle(t);return u({},this._createDefaultItem(t,i,n),{color:s.barColor,wickColor:s.barWickColor,borderColor:s.barBorderColor,glyphs:i.plot.glyphs})},i}(Ot),At=function(){function t(){this.g=null}return t.prototype.setData=function(t){this.g=t},t.prototype.draw=function(t){if(null!==this.g&&0!==this.g.items.length&&null!==this.g.visibleRange){var i=this.g.histogramBase;t.translate(.5,.5),t.fillStyle=this.g.color,t.lineWidth=1,t.beginPath();for(var n=this.g.visibleRange.from;n<this.g.visibleRange.to;n++){var s=this.g.items[n],h=s.y,r=s.left,u=s.right;t.rect(r,h,u-r,i-h)}t.fill()}},t}();var Bt,zt=function(t){function i(i,n){var s=t.call(this,i,n,!1)||this;return s.i=new M,s.Bt=[],s.zt=[],s.Vt=new Int32Array(0),s.jt=new Int32Array(0),s}return r(i,t),i.prototype.renderer=function(t,i){return this._makeValid(),this.i},i.prototype._fillRawPoints=function(){var t=this,i=this._model.timeScale().barSpacing(),n=this._series.palette();this.zt.length=n.size(),this.Bt.length=n.size();var s=new Int32Array(n.size()+1),h=this._series.options(),r=this._series.barFunction();this.Vt=new Int32Array(this._series.bars().size());var u=0;this._items.length=this._series.bars().size();var e=0,o=this._series.options().color;this._series.bars().each((function(f,a){var c=r(a.plot),l=a.plot.value[4],v={time:f,price:c,x:NaN,y:NaN},d=null!=l?n.colorByIndex(l):o,w=null==l?0:l+1,b=t.Bt[w]||function(t,i,n){return{items:[],barSpacing:t,lineWidth:i,histogramBase:NaN,color:n,visibleRange:null}}(i,h.lineWidth,d),m=s[w]++;return m<b.items.length?b.items[m]=v:b.items.push(v),t._items[e++]={time:f,x:0},t.Bt[w]=b,t.Vt[u++]=w,!1})),this.zt.length=this.Bt.length,this.jt.length!==this.Bt.length&&(this.jt=new Int32Array(this.Bt.length)),this.Bt.forEach((function(i,n){i.items.length=s[n];var h=t.zt[n]||new At;h.setData(i),t.zt[n]=h})),this.i.setRenderers(this.zt)},i.prototype._clearVisibleRange=function(){t.prototype._clearVisibleRange.call(this),this.Bt.forEach((function(t,i){t.visibleRange=null}))},i.prototype._convertToCoordinates=function(t,i,n){var s=this;if(null!==this._itemsVisibleRange){var h=i.barSpacing(),r=f(i.visibleBars()),u=t.priceToCoordinate(this._series.options().base,n);this.Bt.forEach((function(h,e){i.indexesToCoordinates(h.items),t.pointsArrayToCoordinates(h.items,n),h.histogramBase=u,h.visibleRange=yt(h.items,r,!1),s.jt[e]=h.visibleRange.from}));for(var e=null,o=this._itemsVisibleRange.from;o<this._itemsVisibleRange.to;++o){var a=this.Vt[o],c=this.Bt[a],l=this.jt[a]++,v=c.items[l];if(v.left=Math.floor(v.x-.5*h),v.right=Math.ceil(v.left+h),null!==e){var d=v.right-v.left>5?1:0;e.right=v.left-d}e=v}}},i}(kt),Vt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Ct=new bt,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={items:this._items,lineColor:n.color,lineStyle:n.lineStyle,lineType:0,lineWidth:n.lineWidth,visibleRange:this._itemsVisibleRange};return this.Ct.setData(s),this.Ct},i.prototype._createRawItem=function(t,i){return this._createRawItemBase(t,i)},i}(Nt),jt=/[2-9]/g,Ft=function(){function t(t){void 0===t&&(t=50),this.Ft=0,this.It=1,this.Pt=1,this.Wt={},this.Rt={},this.Ut=t}return t.prototype.reset=function(){this.Ft=0,this.Rt={},this.It=1,this.Pt=1,this.Wt={}},t.prototype.measureText=function(t,i,n){var s=n||jt,h=String(i).replace(s,"0");if(this.Rt[h])return this.Rt[h].width;if(this.Ft===this.Ut){var r=this.Wt[this.Pt];delete this.Wt[this.Pt],delete this.Rt[r],this.Pt++,this.Ft--}var u=t.measureText(h).width;return 0===u&&i.length?0:(this.Rt[h]={width:u,tick:this.It},this.Wt[this.It]=h,this.Ft++,this.It++,u)},t}(),It=function(){function t(t){this.qt=null,this.Ht=null,this.Yt="right",this.Jt=0,this.Kt=t}return t.prototype.setParams=function(t,i,n,s){this.qt=t,this.Ht=i,this.Jt=n,this.Yt=s},t.prototype.draw=function(t){null!==this.Ht&&null!==this.qt&&this.qt.draw(t,this.Ht,this.Kt,this.Jt,this.Yt)},t}(),Pt=function(){function t(t,i,n){this.$t=t,this.Kt=new Ft(50),this.Xt=i,this.l=n,this._t=-1,this.p=new It(this.Kt)}return t.prototype.update=function(){this.$t.update()},t.prototype.renderer=function(t,i){var n=this.l.paneForSource(this.Xt);if(null===n)return null;if(null===this.Xt.priceScale())return null;var s=n.priceScalePosition();if("overlay"===s)return null;var h=this.l.priceAxisRendererOptions();return h.fontSize!==this._t&&(this._t=h.fontSize,this.Kt.reset()),this.p.setParams(this.$t.paneRenderer(),h,i,s),this.p},t}(),Wt=function(){function t(){this.g=null}return t.prototype.setData=function(t){this.g=t},t.prototype.draw=function(t){if(null!==this.g&&!1!==this.g.visible){var i=this.g.y;if(!(i<0||i>this.g.height)){var s=this.g.width;t.lineCap="square",t.strokeStyle=this.g.color,t.lineWidth=this.g.lineWidth,n(t,0,i,s,i,this.g.lineStyle)}}},t}(),Rt=function(){function t(t){this._lineRendererData={width:0,height:0,y:0,color:"rgba(0, 0, 0, 0)",lineWidth:1,lineStyle:0,visible:!1},this._lineRenderer=new Wt,this.o=!0,this._series=t,this._model=t.model(),this._lineRenderer.setData(this._lineRendererData)}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(){return this.o&&(this._updateImpl(),this.o=!1),this._lineRenderer},t}(),Ut=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.priceScale(),i=t.mode().mode;if(2===i||3===i){var n=this._series.options();if(n.baseLineVisible){var s=this._series.firstValue();null!==s&&(this._lineRendererData.visible=!0,this._lineRendererData.y=t.priceToCoordinate(s.value,s.value),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=t.height(),this._lineRendererData.color=n.baseLineColor,this._lineRendererData.lineWidth=n.baseLineWidth,this._lineRendererData.lineStyle=n.baseLineStyle)}}},i}(Rt);function qt(t,i){return Yt(Math.min(Math.max(t,12),30)*i)}function Ht(t,i){switch(t){case"arrowDown":case"arrowUp":return qt(i,1);case"circle":return qt(i,.8);case"square":return qt(i,.7)}}function Yt(t){var i=Math.ceil(t);return i%2==0?i-1:i}function Jt(t){return i=qt(t,1),(n=Math.ceil(i))%2!=0?n-1:n;var i,n}function Kt(t,i,n,s,h){var r=Ht("square",n),u=(r-1)/2,e=t-u,o=i-u;return s>=e&&s<=e+r&&h>=o&&h<=o+r}function $t(t,i,n,s,h,r){var u=(Ht("arrowUp",r)-1)/2,e=(Yt(r/2)-1)/2;i.fillStyle=h,i.beginPath(),t?(i.moveTo(n-u,s),i.lineTo(n,s-u),i.lineTo(n+u,s),i.lineTo(n+e,s),i.lineTo(n+e,s+u),i.lineTo(n-e,s+u),i.lineTo(n-e,s)):(i.moveTo(n-u,s),i.lineTo(n,s+u),i.lineTo(n+u,s),i.lineTo(n+e,s),i.lineTo(n+e,s-u),i.lineTo(n-e,s-u),i.lineTo(n-e,s)),i.fill()}function Xt(t,i,n,s,h,r){return Kt(i,n,s,h,r)}!function(t){t[t.MinShapeSize=12]="MinShapeSize",t[t.MaxShapeSize=30]="MaxShapeSize",t[t.MinShapeMargin=3]="MinShapeMargin"}(Bt||(Bt={}));var _t=function(){function t(){this.g=null}return t.prototype.setData=function(t){this.g=t},t.prototype.draw=function(t,i,n){if(null!==this.g&&null!==this.g.visibleRange){t.save(),t.translate(.5,.5);for(var s=this.g.visibleRange.from;s<this.g.visibleRange.to;s++){Zt(this.g.items[s],t)}t.restore()}},t.prototype.hitTest=function(t,i){if(null===this.g||null===this.g.visibleRange)return null;for(var n=this.g.visibleRange.from;n<this.g.visibleRange.to;n++){var s=this.g.items[n];if(Gt(s,t,i))return{hitTestData:s.internalId,externalId:s.externalId}}return null},t}();function Zt(t,i){switch(t.shape){case"arrowDown":return void $t(!1,i,t.x,t.y,t.color,t.size);case"arrowUp":return void $t(!0,i,t.x,t.y,t.color,t.size);case"circle":return void function(t,i,n,s,h){var r=(Ht("circle",h)-1)/2;t.fillStyle=s,t.beginPath(),t.arc(i,n,r,0,2*Math.PI,!1),t.fill()}(i,t.x,t.y,t.color,t.size);case"square":return void function(t,i,n,s,h){var r=Ht("square",h),u=(r-1)/2,e=i-u,o=n-u;t.fillStyle=s,t.fillRect(e,o,r,r)}(i,t.x,t.y,t.color,t.size)}t.shape}function Gt(t,i,n){switch(t.shape){case"arrowDown":case"arrowUp":return Xt(0,t.x,t.y,t.size,i,n);case"circle":return function(t,i,n,s,h){var r=2+Ht("circle",n)/2,u=t-s,e=i-h;return Math.sqrt(u*u+e*e)<=r}(t.x,t.y,t.size,i,n);case"square":return Kt(t.x,t.y,t.size,i,n)}t.shape}function Qt(t,i,n,s,h,r,u,e){var o=l(n)?n:n.close,f=l(n)?n:n.high,a=l(n)?n:n.low,c=Jt(u.barSpacing());switch(t.size=c,i.position){case"inBar":return void(t.y=r.priceToCoordinate(o,e));case"aboveBar":return t.y=r.priceToCoordinate(f,e)-c/2-s.aboveBar,void(s.aboveBar+=c+h);case"belowBar":return t.y=r.priceToCoordinate(a,e)+c/2+s.belowBar,void(s.belowBar+=c+h)}i.position}var ti,ii=function(){function t(t,i){this.o=!0,this.Zt=!0,this.Gt=null,this.p=new _t,this.Qt=t,this.V=i,this.g={items:[],visibleRange:null}}return t.prototype.update=function(t){this.o=!0,"data"===t&&(this.Zt=!0)},t.prototype.renderer=function(t,i,n){return this.o&&this._makeValid(),this.p.setData(this.g),this.p},t.prototype.autoScaleMargins=function(){return this.o&&this._makeValid(),this.Gt},t.prototype._makeValid=function(){var t=this.Qt.priceScale(),i=this.V.timeScale(),n=this.Qt.indexedMarkers();this.Zt&&(this.g.items=n.map((function(t){return{time:t.time,x:0,y:0,size:0,shape:t.shape,color:t.color,internalId:t.internalId,externalId:t.id}})),this.Zt=!1);var s,h=(s=i.barSpacing(),Math.max(qt(s,.1),3));if(n.length>0){var r=1.5*Jt(i.barSpacing())+2*h;this.Gt={above:r,below:r}}else this.Gt=null;this.g.visibleRange=null;var u=i.visibleBars();if(null!==u){var e=this.Qt.firstValue();if(null!==e){var o=NaN,f={aboveBar:h,belowBar:h};this.g.visibleRange=yt(this.g.items,u,!0);for(var a=this.g.visibleRange.from;a<this.g.visibleRange.to;a++){var c=n[a];c.time!==o&&(f.aboveBar=h,f.belowBar=h,o=c.time);var l=this.g.items[a];l.x=i.indexToCoordinate(c.time);var v=this.Qt.dataAt(c.time);null!==v&&Qt(l,c,v,f,h,t,i,e.value)}this.o=!1}}},t}(),ni=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.options();if(t.priceLineVisible){var i=this._series.lastValueData(void 0,!0);i.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=i.coordinate,this._lineRendererData.color=this._series.priceLineColor(i.color),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=this._series.priceScale().height(),this._lineRendererData.lineWidth=t.priceLineWidth,this._lineRendererData.lineStyle=t.priceLineStyle)}},i}(Rt),si=function(t){function i(i,n){var s=t.call(this)||this;return s.k=i,s.g=n,s}return r(i,t),i.prototype._getSource=function(){return this.k},i.prototype._getData=function(){return this.g},i.prototype._updateRendererData=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.k.options(),h=s.lastValueVisible,r=""!==this.k.title(),u=0===s.seriesLastValueMode,e=this.k.lastValueData(void 0,!1);e.noData||(h&&(t.text=this._axisText(e,h,u),t.visible=0!==t.text.length),(r||u)&&(i.text=this._paneText(e,h,r,u),i.visible=i.text.length>0),n.background=this.k.priceLineColor(e.color),n.color=j(n.background),n.coordinate=e.coordinate,n.floatCoordinate=e.floatCoordinate)},i.prototype._paneText=function(t,i,n,s){var h="",r=this.k.title();return n&&0!==r.length&&(h+=r+" "),i&&s&&(h+=this.k.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),h.trim()},i.prototype._axisText=function(t,i,n){return i?n?this.k.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(I),hi=function(){function t(){this.ti=0,this.ii=new Map,this.ni=new Map}return t.prototype.colorByIndex=function(t){return o(this.ni.get(t))},t.prototype.addColor=function(t){var i=this.ii.get(t);return void 0===i&&(i=this.ti++,this.ii.set(t,i),this.ni.set(i,t)),i},t.prototype.clear=function(){this.ti=0,this.ii.clear(),this.ni.clear()},t.prototype.size=function(){return this.ni.size},t}(),ri={barColor:"",barBorderColor:"",barWickColor:""},ui=function(){function t(t){this.Qt=t}return t.prototype.barStyle=function(t,i){var n=this.Qt.seriesType(),s=this.Qt.options();switch(n){case"Line":return this.si(s);case"Area":return this.hi(s);case"Bar":return this.ri(s,t,i);case"Candlestick":return this.ui(s,t,i);case"Histogram":return this.ei(s,t,i)}throw new Error("Unknown chart style")},t.prototype.ri=function(t,i,n){var s=u({},ri),h=t.upColor,r=t.downColor,e=h,o=r,c=f(this.oi(i,n)),l=a(c.plot.value[0])<=a(c.plot.value[3]);return s.barColor=l?h:r,s.barBorderColor=l?e:o,s},t.prototype.ui=function(t,i,n){var s=u({},ri),h=t.upColor,r=t.downColor,e=t.borderUpColor,o=t.borderDownColor,c=t.wickUpColor,l=t.wickDownColor,v=f(this.oi(i,n)),d=a(v.plot.value[0])<=a(v.plot.value[3]);return s.barColor=d?h:r,s.barBorderColor=d?e:o,s.barWickColor=d?c:l,s},t.prototype.hi=function(t){return u({},ri,{barColor:t.lineColor})},t.prototype.si=function(t){return u({},ri,{barColor:t.color})},t.prototype.ei=function(t,i,n){var s=u({},ri),h=f(this.oi(i,n)).plot.value[4];if(null!=h){var r=f(this.Qt.palette());s.barColor=r.colorByIndex(h)}else s.barColor=t.color;return s},t.prototype.fi=function(){return this.Qt.bars()},t.prototype.oi=function(t,i){return void 0!==i?i.value:this.fi().valueAt(t)},t}();!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(ti||(ti={}));var ei,oi=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.ai=[],this.ci=0,this.li=0,this.vi=!1,this.di=new Map,this.wi=new Map,this.bi=new Map,this.mi=t||new Map,this.gi=i}return t.prototype.clear=function(){this.ai=[],this.ci=0,this.li=0,this.vi=!1,this.di.clear(),this.wi.clear(),this.bi.clear()},t.prototype.first=function(){return this.size()>0?this.ai[this.ci]:null},t.prototype.last=function(){return this.size()>0?this.ai[this.li-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.Mi(this.ci):null},t.prototype.lastIndex=function(){return this.size()>0?this.Mi(this.li-1):null},t.prototype.size=function(){return this.li-this.ci},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.pi(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.add=function(t,i,n){if(this.vi)return!1;var s={index:t,plot:n,time:i},h=this.pi(t,0);return this.wi.clear(),this.bi.clear(),null===h?(this.ai.splice(this.yi(t),0,s),this.ci=0,this.li=this.ai.length,!0):(this.ai[h]=s,!1)},t.prototype.search=function(t,i,n){void 0===i&&(i=0);var s=this.pi(t,i,n);if(null===s)return null;var h=this.ki(s);return{index:this.Mi(s),time:h.time,plot:h.plot}},t.prototype.each=function(t){for(var i=this.ci;i<this.li;++i){if(t(this.Mi(i),this.ki(i)))break}},t.prototype.range=function(i,n){var s=new t(this.mi,this.gi);return s.ai=this.ai,s.ci=this.yi(i),s.li=this.Ni(n),s.vi=!0,s},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var s=null,h=0,r=n;h<r.length;h++){var u=r[h];s=fi(s,this.Si(t,i,u))}return s},t.prototype.merge=function(t){return this.vi?null:0===t.length?null:this.isEmpty()||t[t.length-1].index<this.ai[0].index?this.xi(t):t[0].index>this.ai[this.ai.length-1].index?this.Ci(t):1===t.length&&t[0].index===this.ai[this.ai.length-1].index?(this.Di(t[0]),t[0]):this.Oi(t)},t.prototype.remove=function(t){if(this.vi)return null;var i=this.pi(t,1);if(null===i)return null;var n=this.ai.splice(i);return this.li=this.ai.length,this.di.clear(),this.wi.clear(),this.bi.clear(),n.length>0?n[0]:null},t.prototype.Mi=function(t){return this.ai[t].index},t.prototype.ki=function(t){return this.ai[t]},t.prototype.pi=function(t,i,n){var s=this.Ei(t);if(null===s&&0!==i)switch(i){case-1:return this.Ti(t,n);case 1:return this.Li(t,n);default:throw new TypeError("Unknown search mode")}if(!n||null===s||0===i)return s;switch(i){case-1:return this.Ai(s);case 1:return this.Bi(s);default:throw new TypeError("Unknown search mode")}},t.prototype.Bi=function(t){for(var i=f(this.gi);t<this.li&&i(this.ki(t).plot);)t+=1;return t===this.li?null:t},t.prototype.Ai=function(t){for(var i=f(this.gi);t>=this.ci&&i(this.ki(t).plot);)t-=1;return t<this.ci?null:t},t.prototype.Ti=function(t,i){var n=this.yi(t);n>this.ci&&(n-=1);var s=n!==this.li&&this.Mi(n)<t?n:null;return i&&null!==s?this.Ai(s):s},t.prototype.Li=function(t,i){var n=this.Ni(t),s=n!==this.li&&t<this.Mi(n)?n:null;return i&&null!==s?this.Bi(s):s},t.prototype.Ei=function(t){var i=this.yi(t);return i===this.li||t<this.ai[i].index?null:i},t.prototype.yi=function(t){return mt(this.ai,t,(function(t,i){return t.index<i}),this.ci,this.li)},t.prototype.Ni=function(t){return gt(this.ai,t,(function(t,i){return i.index>t}),this.ci,this.li)},t.prototype.zi=function(t,i,n){var s=null,h=this.mi.get(n.name);if(void 0===h)throw new Error('Plot "'+n.name+'" is not registered');for(var r=t;r<i;r++){var u=h(this.ai[r].plot);null==u||Number.isNaN(u)||(null===s?s={min:u,max:u}:(u<s.min&&(s.min=u),u>s.max&&(s.max=u)))}return s},t.prototype.Vi=function(t){var i=Math.floor(t.index/30);this.di.forEach((function(t){return t.delete(i)}))},t.prototype.xi=function(t){return e(!this.vi,"collection should not be readonly"),e(0!==t.length,"plotRows should not be empty"),this.wi.clear(),this.bi.clear(),this.di.clear(),this.ai=t.concat(this.ai),this.ci=0,this.li=this.ai.length,t[0]},t.prototype.Ci=function(t){return e(!this.vi,"collection should not be readonly"),e(0!==t.length,"plotRows should not be empty"),this.wi.clear(),this.bi.clear(),this.di.clear(),this.ai=this.ai.concat(t),this.ci=0,this.li=this.ai.length,t[0]},t.prototype.Di=function(t){e(!this.isEmpty(),"plot list should not be empty"),e(this.ai[this.li-1].index===t.index,"last row index should match new row index"),this.Vi(t),this.wi.delete(t.index),this.bi.delete(t.index),this.ai[this.li-1]=t},t.prototype.Oi=function(t){return e(0!==t.length,"plot rows should not be empty"),this.wi.clear(),this.bi.clear(),this.di.clear(),this.ai=function(t,i){var n=function(t,i){var n=t.length,s=i.length,h=n+s,r=0,u=0;for(;r<n&&u<s;)t[r].index<i[u].index?r++:t[r].index>i[u].index?u++:(r++,u++,h--);return h}(t,i),s=new Array(n),h=0,r=0,u=t.length,e=i.length,o=0;for(;h<u&&r<e;)t[h].index<i[r].index?(s[o]=t[h],h++):t[h].index>i[r].index?(s[o]=i[r],r++):(s[o]=i[r],h++,r++),o++;for(;h<u;)s[o]=t[h],h++,o++;for(;r<e;)s[o]=i[r],r++,o++;return s}(this.ai,t),this.ci=0,this.li=this.ai.length,t[0]},t.prototype.Si=function(t,i,n){if(this.isEmpty())return null;var s=null,h=f(this.firstIndex()),r=f(this.lastIndex()),u=t-n.offset,e=i-n.offset;u=Math.max(u,h),e=Math.min(e,r);var o=30*Math.ceil(u/30),a=Math.max(o,30*Math.floor(e/30)),c=this.yi(u),l=this.Ni(Math.min(e,o,i));s=fi(s,this.zi(c,l,n));var v=this.di.get(n.name);void 0===v&&(v=new Map,this.di.set(n.name,v));for(var d=Math.max(o+1,u);d<a;d+=30){var w=Math.floor(d/30),b=v.get(w);if(void 0===b){var m=this.yi(30*w),g=this.Ni(30*(w+1)-1);b=this.zi(m,g,n),v.set(w,b)}s=fi(s,b)}c=this.yi(a),l=this.Ni(e);return s=fi(s,this.zi(c,l,n))},t}();function fi(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}!function(t){t[t.Open=0]="Open",t[t.High=1]="High",t[t.Low=2]="Low",t[t.Close=3]="Close",t[t.Color=4]="Color"}(ei||(ei={}));var ai={open:function(t){return t.value[0]},high:function(t){return t.value[1]},low:function(t){return t.value[2]},close:function(t){return t.value[3]},hl2:function(t){return(t.value[1]+t.value[2])/2},hlc3:function(t){return(t.value[1]+t.value[2]+t.value[3])/3},ohlc4:function(t){return(t.value[0]+t.value[1]+t.value[2]+t.value[3])/4}},ci=["open","high","low","close","hl2","hlc3","ohlc4"];function li(t){return ai[t]}var vi,di=function(){function t(){var t;this.ji=new oi((t=new Map,ci.forEach((function(i,n){t.set(i,li(i))})),t))}return t.prototype.bars=function(){return this.ji},t.prototype.size=function(){return this.ji.size()},t.prototype.each=function(t){this.ji.each(t)},t.prototype.clear=function(){this.ji.clear()},t.prototype.isEmpty=function(){return this.ji.isEmpty()},t.prototype.first=function(){return this.ji.first()},t.prototype.last=function(){return this.ji.last()},t.prototype.search=function(t,i){return this.bars().search(t,i)},t.prototype.valueAt=function(t){return this.search(t)},t}(),wi=function(t){function i(i,n,s){var h=t.call(this,i)||this;h.g=new di,h.Fi=new ni(h),h.Ii=new Ut(h),h.Pi=!1,h.Z=null,h.Wi=null,h.Ri=new hi,h.Ui=[],h.qi=[],h.K=n,h.Hi=s,h.createPaneView();var r=new si(h,{model:i});return h.R=[r],h.Yi=new Pt(r,h,i),h.Ji(),h.Ki(),h.$i=h.barFunction(),h.$=new ii(h,i),h}return r(i,t),i.prototype.destroy=function(){},i.prototype.endOfData=function(){return this.Pi},i.prototype.priceLineColor=function(t){return this.K.priceLineColor||t},i.prototype.lastValueData=function(t,i,n){var s={noData:!0},h=this.priceScale();if(this.model().timeScale().isEmpty()||h.isEmpty()||this.data().isEmpty())return s;var r,u,e=this.model().timeScale().visibleBars(),o=this.firstValue();if(null===e||null===o)return s;if(i){var f=this.data().bars().last();if(null===f)return s;r=f,u=f.index}else{var a=this.data().bars().search(e.lastBar(),-1);if(null===a)return s;if(null===(r=this.data().bars().valueAt(a.index)))return s;u=a.index}var c=void 0!==t?r.plot.value[t]:this.$i(r.plot),l=this.barColorer().barStyle(u,{value:r}),v=h.priceToCoordinate(c,o.value,!0);return{noData:!1,price:n?c:void 0,text:h.formatPrice(c,o.value),formattedPriceAbsolute:h.formatPriceAbsolute(c),formattedPricePercentage:h.formatPricePercentage(c,o.value),color:l.barColor,floatCoordinate:v,coordinate:Math.round(v),index:u}},i.prototype.data=function(){return this.g},i.prototype.createPaneView=function(){switch(this.Z=null,this.Hi){case"Bar":this.Z=new Et(this,this.model());break;case"Candlestick":this.Z=new Lt(this,this.model());break;case"Line":this.Z=new Vt(this,this.model());break;case"Area":this.Z=new St(this,this.model());break;case"Histogram":this.Z=new zt(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.Hi)}},i.prototype.barColorer=function(){return null!==this.Wi?this.Wi:(this.Wi=new ui(this),this.Wi)},i.prototype.options=function(){return this.K},i.prototype.applyOptions=function(t){var i=this.K.overlay;c(this.K,t),this.K.overlay=i,i&&null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:this.K.scaleMargins}),void 0!==t.priceFormat&&this.Ji(),this.model().updateSource(this)},i.prototype.setData=function(t){this.g.clear(),this.g.bars().merge(t),this.Xi(),null!==this.Z&&this.Z.update("data"),this.$.update("data");var i=this.model().paneForSource(this);this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.Ui=t.map((function(t){return u({},t)})),this.Xi();var i=this.model().paneForSource(this);this.$.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.markers=function(){return this.Ui},i.prototype.indexedMarkers=function(){return this.qi},i.prototype.updateData=function(t){this.g.bars().merge(t),this.Xi(),null!==this.Z&&this.Z.update("data"),this.$.update("data");var i=this.model().paneForSource(this);this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.palette=function(){return this.Ri},i.prototype.seriesType=function(){return this.Hi},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:this.$i(t.plot),timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleBars();if(null===t)return null;var i=t.firstBar();return this.data().search(i,1)},i.prototype.bars=function(){return this.g.bars()},i.prototype.nearestIndex=function(t,i){var n=this.nearestData(t,i);return n?n.index:null},i.prototype.nearestData=function(t,i){return v(t)?this.data().search(t,i):null},i.prototype.dataAt=function(t){var i=this.data().valueAt(t);return null===i?null:"Bar"===this.Hi||"Candlestick"===this.Hi?{open:i.plot.value[0],high:i.plot.value[1],low:i.plot.value[2],close:i.plot.value[3]}:this.barFunction()(i.plot)},i.prototype.paneViews=function(){var t=[];return this.priceScale()===this.model().mainPriceScale()&&t.push(this.Ii),t.push(f(this.Z)),t.push(this.Fi),t.push(this.Yi),t.push(this.$),t},i.prototype.priceAxisViews=function(t,i){return this.R},i.prototype.autoscaleInfo=function(t,i){if(!v(t)||!v(i)||this.data().isEmpty())return null;var n,s="Line"===this.Hi||"Area"===this.Hi||"Histogram"===this.Hi?"close":null,h=null!==(n=null!==s?this.data().bars().minMaxOnRangeCached(t,i,[{name:s,offset:0}]):this.data().bars().minMaxOnRangeCached(t,i,[{name:"low",offset:0},{name:"high",offset:0}]))?new tt(n.min,n.max):null;if("Histogram"===this.seriesType()){var r=this.K.base,u=new tt(r,r);h=null!==h?h.merge(u):u}return{priceRange:h,margins:this.$.autoScaleMargins()}},i.prototype.minMove=function(){return this.K.priceFormat.minMove},i.prototype.formatter=function(){return this._i},i.prototype.barFunction=function(){return this.$i},i.prototype.updateAllViews=function(){if(null!==this.Z){this.Z.update(),this.$.update();for(var t=this.R.length,i=0;i<t;i++)this.R[i].update();this.Fi.update(),this.Ii.update()}},i.prototype.setPriceScale=function(t){this._priceScale!==t&&(this._priceScale=t)},i.prototype.priceScale=function(){return f(this._priceScale)},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.Hi||"Area"===this.Hi)&&this.K.crosshairMarkerVisible))return null;var i=this.g.valueAt(t);return null===i?null:{price:this.$i(i.plot),radius:this.Zi()}},i.prototype.title=function(){return this.K.title},i.prototype.Zi=function(){switch(this.Hi){case"Line":case"Area":return this.K.crosshairMarkerRadius}return 0},i.prototype.Ji=function(){switch(this.K.priceFormat.type){case"custom":this._i={format:this.K.priceFormat.formatter};break;case"volume":this._i=new vt(this.K.priceFormat.precision);break;case"percent":this._i=new Z(this.K.priceFormat.precision);break;default:var t=Math.pow(10,this.K.priceFormat.precision);this._i=new _(t,this.K.priceFormat.minMove*t,!1,void 0)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.Ki=function(){this.$i=li("close")},i.prototype.Xi=function(){var t=this.model().timeScale().points();this.qi=this.Ui.map((function(i,n){return{time:f(t.indexOf(i.time.timestamp,!0)),position:i.position,shape:i.shape,color:i.color,id:i.id,internalId:n}}))},i}(Q);function bi(t){return t.slice().sort((function(t,i){return f(t.zorder())-f(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(vi||(vi={}));var mi=new Z,gi=new _(100,1),Mi=function(){function t(t,i,n){this.Gi=0,this.Qi=null,this.tn=new G,this.in=null,this.nn=null,this.sn=new G,this.hn={isValid:!1,visibleBars:null},this.rn=0,this.un=0,this.en=new G,this.on=new G,this.fn=[],this.an=null,this.cn=!1,this.ln=null,this.vn=null,this.dn=null,this.wn=null,this._i=gi,this.bn=new G,this.K=t,this.mn=i,this.gn=n,this.Mn=new lt(this,100,this.pn.bind(this),this.yn.bind(this))}return t.prototype.options=function(){return this.K},t.prototype.applyOptions=function(t){if(c(this.K,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),this.bn.fire(),void 0!==t.scaleMargins){var i=o(t.scaleMargins.top),n=o(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+n);if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+n));this.kn(),this.vn=null}},t.prototype.optionsChanged=function(){return this.bn},t.prototype.isAutoScale=function(){return this.K.autoScale},t.prototype.isLog=function(){return 1===this.K.mode},t.prototype.isPercentage=function(){return 2===this.K.mode},t.prototype.isIndexedTo100=function(){return 3===this.K.mode},t.prototype.mode=function(){return{autoScale:this.K.autoScale,isInverted:this.K.invertScale,mode:this.K.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.K.autoScale=t.autoScale),void 0!==t.mode&&(this.K.mode=t.mode,2!==t.mode&&3!==t.mode||(this.K.autoScale=!0),this.hn.isValid=!1),1===i.mode&&t.mode!==i.mode&&(!function(t){if(null===t)return!1;var i=ft(t.minValue()),n=ft(t.maxValue());return isFinite(i)&&isFinite(n)}(this.in)?this.K.autoScale=!0:null!==(n=function(t){if(null===t)return null;var i=ft(t.minValue()),n=ft(t.maxValue());return new tt(i,n)}(this.in))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=at(this.in))&&this.setPriceRange(n);var s=i.mode!==this.K.mode;s&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),s&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.K.invertScale=t.isInverted,this.Nn()),this.on.fire(i,this.mode())},t.prototype.modeChanged=function(){return this.on},t.prototype.fontSize=function(){return this.mn.fontSize},t.prototype.height=function(){return this.Gi},t.prototype.setHeight=function(t){this.Gi!==t&&(this.Gi=t,this.kn(),this.vn=null)},t.prototype.internalHeight=function(){if(this.Qi)return this.Qi;var t=this.height()-this.Sn()-this.xn();return this.Qi=t,t},t.prototype.internalHeightChanged=function(){return this.tn},t.prototype.priceRange=function(){return this.Cn(),this.in},t.prototype.priceRangeChanged=function(){return this.sn},t.prototype.setPriceRange=function(t,i,n){var s=this.in;(i||null===s&&null!==t||null!==s&&!s.equals(t))&&(this.vn=null,this.in=t,n||this.sn.fire(s,t))},t.prototype.isEmpty=function(){return this.Cn(),0===this.Gi||!this.in||this.in.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i,n){return this.isPercentage()?t=ht(t,i):this.isIndexedTo100()&&(t=ut(t,i)),this.yn(t,i,n)},t.prototype.pointsArrayToCoordinates=function(t,i,n){var s=this;this.Cn();for(var h=this.xn(),r=f(this.priceRange()),u=r.minValue(),e=r.maxValue(),o=this.internalHeight()-1,a=this.isInverted(),c=o/(e-u),l=void 0===n?0:n.from,v=void 0===n?t.length:n.to,d=this.Dn(),w=function(t){var n=t;null!==d&&(n=d(t,i));var r=h+c*(n-u),e=a?r:s.Gi-1-r;return Math.round(e)},b=l;b<v;b++){var m=t[b],g=m.price;isNaN(g)||(m.y=w(g))}return w(0)},t.prototype.barPricesToCoordinates=function(t,i,n){this.Cn();for(var s=this.xn(),h=f(this.priceRange()),r=h.minValue(),u=h.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),c=void 0===n?0:n.from,l=void 0===n?t.length:n.to,v=this.Dn(),d=c;d<l;d++){var w=t[d],b=w.open,m=w.high,g=w.low,M=w.close;null!==v&&(b=v(w.open,i),m=v(w.high,i),g=v(w.low,i),M=v(w.close,i));var p=s+a*(b-r),y=o?p:this.Gi-1-p;w.openY=Math.round(y),p=s+a*(m-r),y=o?p:this.Gi-1-p,w.highY=Math.round(y),p=s+a*(g-r),y=o?p:this.Gi-1-p,w.lowY=Math.round(y),p=s+a*(M-r),y=o?p:this.Gi-1-p,w.closeY=Math.round(y)}},t.prototype.coordinateToPrice=function(t,i){var n=this.pn(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.fn},t.prototype.orderedSources=function(){if(this.an)return this.an;for(var t=[],i=0;i<this.fn.length;i++){var n=this.fn[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=bi(t),this.an=t,this.an},t.prototype.hasSeries=function(){return this.cn},t.prototype.addDataSource=function(t){-1===this.fn.indexOf(t)&&(t instanceof wi&&(this.cn=!0),this.fn.push(t),this.ln=null,this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.fn.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.fn.splice(i,1),t instanceof wi&&(this.cn=!1),this.mainSource()||this.setMode({autoScale:!0}),this.ln=null,this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.mainSource=function(){if(null!==this.ln)return this.ln;for(var t=null,i=0;i<this.fn.length;i++){var n=this.fn[i];if(n instanceof wi){t=n;break}null===t&&n instanceof Q&&(t=n)}return this.ln=t,this.ln},t.prototype.firstValue=function(){for(var t=null,i=0,n=this.fn;i<n.length;i++){var s=n[i];if(s instanceof Q){var h=s.firstValue();if(null===h)continue;(null===t||h.timePoint<t.timePoint)&&(t=h)}}return null===t?null:t.value},t.prototype.isInverted=function(){return this.K.invertScale},t.prototype.marks=function(){return this.vn?this.vn:(this.Mn.rebuildTickMarks(),this.vn=this.Mn.marks(),this.en.fire(),this.vn)},t.prototype.onMarksChanged=function(){return this.en},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.dn&&null===this.nn&&(this.isEmpty()||(this.dn=this.Gi-t,this.nn=f(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.dn){this.setMode({autoScale:!1}),(t=this.Gi-t)<0&&(t=0);var i=(this.dn+.2*(this.Gi-1))/(t+.2*(this.Gi-1)),n=f(this.nn).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.dn=null,this.nn=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.wn&&null===this.nn&&(this.isEmpty()||(this.wn=t,this.nn=f(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.wn){var i=f(this.priceRange()).length()/(this.height()-1),n=t-this.wn;this.isInverted()&&(n*=-1);var s=n*i,h=f(this.nn).clone();h.shift(s),this.setPriceRange(h,!0),this.vn=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.wn&&(this.wn=null,this.nn=null)},t.prototype.formatter=function(){return this._i||this.updateFormatter(),this._i},t.prototype.formatPrice=function(t,i){switch(this.K.mode){case 2:return this.formatter().format(ht(t,i));case 3:return this.formatter().format(ut(t,i));default:return this.On(t)}},t.prototype.formatLogical=function(t){switch(this.K.mode){case 2:case 3:return this.formatter().format(t);default:return this.On(t)}},t.prototype.formatPriceAbsolute=function(t){return this.On(t,this.En())},t.prototype.formatPricePercentage=function(t,i){return t=ht(t,i),mi.format(t)},t.prototype.sourcesForAutoScale=function(){return this.fn.filter((function(t){return t instanceof Q}))},t.prototype.recalculatePriceRange=function(t){this.hn={visibleBars:t,isValid:!1}},t.prototype.updateAllViews=function(){this.fn.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.vn=null;var t=this.mainSource(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this._i=gi,this.isPercentage()?(this._i=mi,i=100):this.isIndexedTo100()?(this._i=new _(100,1),i=100):null!==t&&(this._i=t.formatter()),this.Mn=new lt(this,i,this.pn.bind(this),this.yn.bind(this)),this.Mn.rebuildTickMarks()},t.prototype.invalidateSourcesCache=function(){this.an=null},t.prototype.Sn=function(){return this.isInverted()?this.K.scaleMargins.bottom*this.height()+this.un:this.K.scaleMargins.top*this.height()+this.rn},t.prototype.xn=function(){return this.isInverted()?this.K.scaleMargins.top*this.height()+this.rn:this.K.scaleMargins.bottom*this.height()+this.un},t.prototype.Cn=function(){this.hn.isValid||(this.hn.isValid=!0,this.Tn())},t.prototype.kn=function(){this.Qi=null,this.tn.fire()},t.prototype.yn=function(t,i,n){if(this.Cn(),this.isEmpty())return 0;t=this.isLog()&&t?ot(t):t;var s=f(this.priceRange()),h=this.xn()+(this.internalHeight()-1)*(t-s.minValue())/s.length(),r=this.invertedCoordinate(h);return n?r:Math.round(r)},t.prototype.pn=function(t,i){if(this.Cn(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),s=f(this.priceRange()),h=s.minValue()+s.length()*((n-this.xn())/(this.internalHeight()-1));return this.isLog()?ft(h):h},t.prototype.Nn=function(){this.vn=null,this.Mn.rebuildTickMarks()},t.prototype.En=function(){return f(this.mainSource()).formatter()},t.prototype.Tn=function(){var t=this.hn.visibleBars;if(null!==t){for(var i=null,n=0,s=0,h=0,r=this.sourcesForAutoScale();h<r.length;h++){var u=r[h],e=u.firstValue();if(null!==e){var o=u.autoscaleInfo(t.firstBar(),t.lastBar()),a=o&&o.priceRange;if(null!==a){switch(this.K.mode){case 1:a=at(a);break;case 2:a=rt(a,e.value);break;case 3:a=et(a,e.value)}i=null===i?a:i.merge(f(a)),null!==o&&null!==o.margins&&(n=Math.max(n,o.margins.above),s=Math.max(n,o.margins.below))}}}if(n===this.rn&&s===this.un||(this.rn=n,this.un=s,this.vn=null,this.kn()),null!==i){if(i.minValue()===i.maxValue()){var c=this.mainSource(),l=5*(null===c||this.isPercentage()||this.isIndexedTo100()?1:c.minMove());i=new tt(i.minValue()-l,i.maxValue()+l)}this.setPriceRange(i)}else null===this.in&&this.setPriceRange(new tt(-.5,.5));this.hn.isValid=!0}},t.prototype.Dn=function(){return this.isPercentage()?ht:this.isIndexedTo100()?ut:this.isLog()?ot:null},t.prototype.On=function(t,i){return void 0===this.gn.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.gn.priceFormatter(t)},t}();function pi(t){return!l(t)&&!d(t)}function yi(t){return l(t)}var ki=/(\d+(?:\.\d+)?)(px|em|rem|pt)/g,Ni=document.createElement("canvas").getContext("2d")||{},Si=Ni.backingStorePixelRatio||Ni.webkitBackingStorePixelRatio||Ni.mozBackingStorePixelRatio||Ni.msBackingStorePixelRatio||Ni.oBackingStorePixelRatio||Ni.backingStorePixelRatio||1,xi=(window.devicePixelRatio||1)/Si;function Ci(t){t.width!==Math.floor(parseInt(f(t.style.width))*xi)&&(t.style.width=t.width+"px",t.width*=xi,t.height*=xi);var i=t.getContext("2d");return null===i?null:new Oi(i,xi)}var Di,Oi=function(){function t(t,i){this.canvas=t.canvas,this.Ln=t,this.An=i}return t.prototype.restore=function(){this.Ln.restore()},t.prototype.save=function(){this.Ln.save()},t.prototype.getTransform=function(){return this.Ln.getTransform()},t.prototype.resetTransform=function(){this.Ln.resetTransform()},t.prototype.rotate=function(t){this.Ln.rotate(t)},t.prototype.scale=function(t,i){this.Ln.scale(t,i)},t.prototype.setTransform=function(t,i,n,s,h,r){l(t)?this.Ln.setTransform(t,i,n,s,h,r):this.Ln.setTransform(t)},t.prototype.transform=function(t,i,n,s,h,r){this.Ln.transform(t,i,n,s,h,r)},t.prototype.translate=function(t,i){this.Ln.translate(t*this.An,i*this.An)},Object.defineProperty(t.prototype,"globalAlpha",{get:function(){return this.Ln.globalAlpha},set:function(t){this.Ln.globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalCompositeOperation",{get:function(){return this.Ln.globalCompositeOperation},set:function(t){this.Ln.globalCompositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingEnabled",{get:function(){return this.Ln.imageSmoothingEnabled},set:function(t){this.Ln.imageSmoothingEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingQuality",{get:function(){return this.Ln.imageSmoothingQuality},set:function(t){this.Ln.imageSmoothingQuality=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{get:function(){return this.Ln.fillStyle},set:function(t){this.Ln.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{get:function(){return this.Ln.strokeStyle},set:function(t){this.Ln.strokeStyle=t},enumerable:!0,configurable:!0}),t.prototype.createLinearGradient=function(t,i,n,s){return this.Ln.createLinearGradient(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.createPattern=function(t,i){return this.Ln.createPattern(t,i)},t.prototype.createRadialGradient=function(t,i,n,s,h,r){return this.Ln.createRadialGradient(t*this.An,i*this.An,n*this.An,s*this.An,h*this.An,r*this.An)},Object.defineProperty(t.prototype,"shadowBlur",{get:function(){return this.Ln.shadowBlur},set:function(t){this.Ln.shadowBlur=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this.Ln.shadowColor},set:function(t){this.Ln.shadowColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetX",{get:function(){return this.Ln.shadowOffsetX},set:function(t){this.Ln.shadowOffsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{get:function(){return this.Ln.shadowOffsetY},set:function(t){this.Ln.shadowOffsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this.Ln.filter},set:function(t){this.Ln.filter=t},enumerable:!0,configurable:!0}),t.prototype.clearRect=function(t,i,n,s){this.Ln.clearRect(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.fillRect=function(t,i,n,s){this.Ln.fillRect(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.strokeRect=function(t,i,n,s){this.Ln.strokeRect(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.beginPath=function(){this.Ln.beginPath()},t.prototype.clip=function(t,i){"nonzero"===t||"evenodd"===t||void 0===t?this.Ln.clip(t):this.Ln.clip(t,i)},t.prototype.fill=function(t,i){"nonzero"===t||"evenodd"===t||void 0===t?this.Ln.fill(t):this.Ln.fill(t,i)},t.prototype.isPointInPath=function(t,i,n,s){return l(t)?this.Ln.isPointInPath(t*this.An,i*this.An,n):this.Ln.isPointInPath(t,i*this.An,n*this.An,s)},t.prototype.isPointInStroke=function(t,i,n){return l(t)?this.Ln.isPointInStroke(t*this.An,i*this.An):this.Ln.isPointInStroke(t,i*this.An,n*this.An)},t.prototype.stroke=function(t){void 0!==t?this.Ln.stroke(t):this.Ln.stroke()},t.prototype.drawFocusIfNeeded=function(t,i){void 0!==i?this.Ln.drawFocusIfNeeded(t,i):this.Ln.drawFocusIfNeeded(t)},t.prototype.scrollPathIntoView=function(t){void 0!==t?this.Ln.scrollPathIntoView(t):this.Ln.scrollPathIntoView()},t.prototype.fillText=function(t,i,n,s){var h=this;1!==this.An&&(this.font=this.font.replace(ki,(function(t,i,n){return i*h.An+n}))),void 0===s?this.Ln.fillText(t,i*this.An,n*this.An):this.Ln.fillText(t,i*this.An,n*this.An,s*this.An),-1!==this.An&&(this.font=this.font.replace(ki,(function(t,i,n){return i/h.An+n})))},t.prototype.measureText=function(t){return this.Ln.measureText(t)},t.prototype.strokeText=function(t,i,n,s){var h=this;1!==this.An&&(this.font=this.font.replace(ki,(function(t,i,n){return i*h.An+n}))),void 0===s?this.Ln.strokeText(t,i*this.An,n*this.An):this.Ln.strokeText(t,i*this.An,n*this.An,s*this.An),1!==this.An&&(this.font=this.font.replace(ki,(function(t,i,n){return i/h.An+n})))},t.prototype.drawImage=function(t,i,n,s,h,r,u,e,o){return t instanceof HTMLCanvasElement?this.Bn(t,i,n,s,h,r,u,e,o):this.zn(t,i,n,s,h,r,u,e,o)},t.prototype.createImageData=function(t,i){return l(t)?this.Ln.createImageData(t,i):this.Ln.createImageData(t)},t.prototype.getImageData=function(t,i,n,s){return this.Ln.getImageData(t,i,n,s)},t.prototype.putImageData=function(t,i,n,s,h,r,u){void 0===s?this.Ln.putImageData(t,i,n):this.Ln.putImageData(t,i,n,s,h,r,u)},Object.defineProperty(t.prototype,"lineCap",{get:function(){return this.Ln.lineCap},set:function(t){this.Ln.lineCap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineDashOffset",{get:function(){return this.Ln.lineDashOffset},set:function(t){this.Ln.lineDashOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this.Ln.lineJoin},set:function(t){this.Ln.lineJoin=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this.Ln.lineWidth},set:function(t){this.Ln.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this.Ln.miterLimit},set:function(t){this.Ln.miterLimit=t},enumerable:!0,configurable:!0}),t.prototype.getLineDash=function(){return this.Ln.getLineDash()},t.prototype.setLineDash=function(t){this.Ln.setLineDash(t)},Object.defineProperty(t.prototype,"direction",{get:function(){return this.Ln.direction},set:function(t){this.Ln.direction=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this.Ln.font},set:function(t){this.Ln.font=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textAlign",{get:function(){return this.Ln.textAlign},set:function(t){this.Ln.textAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this.Ln.textBaseline},set:function(t){this.Ln.textBaseline=t},enumerable:!0,configurable:!0}),t.prototype.arc=function(t,i,n,s,h,r){this.Ln.arc(t*this.An,i*this.An,n*this.An,s,h,r)},t.prototype.arcTo=function(t,i,n,s,h){this.Ln.arcTo(t*this.An,i*this.An,n*this.An,s*this.An,h*this.An)},t.prototype.bezierCurveTo=function(t,i,n,s,h,r){this.Ln.bezierCurveTo(t*this.An,i*this.An,n*this.An,s*this.An,h*this.An,r*this.An)},t.prototype.closePath=function(){this.Ln.closePath()},t.prototype.ellipse=function(t,i,n,s,h,r,u,e){this.Ln.ellipse(t,i,n,s,h,r,u,e)},t.prototype.lineTo=function(t,i){this.Ln.lineTo(t*this.An,i*this.An)},t.prototype.moveTo=function(t,i){this.Ln.moveTo(t*this.An,i*this.An)},t.prototype.quadraticCurveTo=function(t,i,n,s){this.Ln.quadraticCurveTo(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.rect=function(t,i,n,s){this.Ln.rect(t*this.An,i*this.An,n*this.An,s*this.An)},t.prototype.Vn=function(t,i,n,s,h,r,u,e,o){void 0===s?this.Ln.drawImage(t,i,n):void 0===r?this.Ln.drawImage(t,i,n,s,h):this.Ln.drawImage(t,i,n,s,h,r,u,e,o)},t.prototype.zn=function(t,i,n,s,h,r,u,e,o){this.Vn(t,i*this.An,n*this.An,void 0===s?s:s*this.An,void 0===h?h:h*this.An,void 0===r?r:r*this.An,void 0===u?u:u*this.An,void 0===e?e:e*this.An,void 0===o?o:o*this.An)},t.prototype.Bn=function(t,i,n,s,h,r,u,e,o){void 0!==r&&("width"in t&&(s=Math.min(t.width,Math.max(1,s))),"height"in t&&(h=Math.min(t.height,Math.max(1,h)))),this.Vn(t,i*this.An,n*this.An,void 0===s?s:s*this.An,void 0===h?h:h*this.An,void 0===r?r:r*this.An,void 0===u?u:u*this.An,void 0===e?e:e*this.An,void 0===o?o:o*this.An)},t}();function Ei(t,i,n){return void 0!==n?n+=" ":n="",void 0===i&&(i="'Trebuchet MS', Roboto, Ubuntu, sans-serif"),""+n+t+"px "+i}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=4]="TickLength",t[t.OffsetSize=1]="OffsetSize"}(Di||(Di={}));var Ti,Li=function(){function t(t){this.Ht={borderSize:1,tickLength:4,offsetSize:1,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.l=t}return t.prototype.options=function(){var t=this.Ht,i=this._t(),n=this.jn();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=Ei(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/5)),t.color=this.Fn(),this.Ht},t.prototype.Fn=function(){return this.l.options().layout.textColor},t.prototype._t=function(){return this.l.options().layout.fontSize},t.prototype.jn=function(){return this.l.options().layout.fontFamily},t}(),Ai=function(){function t(){this.g=null}return t.prototype.setData=function(t){this.g=t},t.prototype.draw=function(t){if(null!==this.g){if(t.lineWidth=1,this.g.vertLinesVisible){t.strokeStyle=this.g.vertLinesColor,s(t,this.g.vertLineStyle),t.beginPath();for(var i=0,n=this.g.timeMarks;i<n.length;i++){var h=n[i];t.moveTo(h.coord+1,0),t.lineTo(h.coord+1,this.g.h)}t.stroke()}if(this.g.horzLinesVisible){t.strokeStyle=this.g.horzLinesColor,s(t,this.g.horzLineStyle),t.beginPath();for(var r=0,u=this.g.priceMarks;r<u.length;r++){var e=u[r];t.moveTo(0,e.coord),t.lineTo(this.g.w,e.coord)}t.stroke()}}},t}(),Bi=function(){function t(t){this.p=new Ai,this.o=!0,this.F=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){if(this.o){var n=this.F.model().options().grid,s={h:t,w:i,horzLinesVisible:n.horzLines.visible,vertLinesVisible:n.vertLines.visible,horzLinesColor:n.horzLines.color,vertLinesColor:n.vertLines.color,horzLineStyle:n.horzLines.style,vertLineStyle:n.vertLines.style,priceMarks:this.F.defaultPriceScale().marks(),timeMarks:this.F.model().timeScale().marks()||[]};this.p.setData(s),this.o=!1}return this.p},t}(),zi=function(){function t(){this.In=new WeakMap,this.o=!0}return t.prototype.paneViews=function(t){var i=this.In.get(t);return void 0===i&&(i=[new Bi(t)],this.In.set(t,i)),this.o&&(i.forEach((function(t){return t.update()})),this.o=!1),i},t.prototype.invalidate=function(){this.o=!0},t}();!function(t){t[t.None=0]="None",t[t.Cursor=1]="Cursor",t[t.Light=2]="Light",t[t.Full=3]="Full"}(Ti||(Ti={}));var Vi=function(){function t(t){this.Pn=new Map,this.Wn=!1,this.Rn=!1,this.Un=null,this.qn=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Pn.get(t),i);this.Pn.set(t,n)},t.prototype.invalidateAll=function(t){this.qn=Math.max(this.qn,t)},t.prototype.fullInvalidation=function(){return this.qn},t.prototype.invalidateForPane=function(t){var i=this.Pn.get(t);return void 0===i?{level:this.qn}:{level:Math.max(this.qn,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.Rn=!0,this.Un=null},t.prototype.getFitContent=function(){return this.Rn},t.prototype.setTargetTimeRange=function(t){this.Un=t,this.Rn=!1},t.prototype.getTargetTimeRange=function(){return this.Un},t.prototype.merge=function(t){var i=this;this.Wn=this.Wn||t.Wn,t.Rn&&this.setFitContent(),t.Un&&this.setTargetTimeRange(t.Un),this.qn=Math.max(this.qn,t.qn),t.Pn.forEach((function(t,n){i.invalidatePane(n,t)}))},t}(),ji=function(){function t(t){this.K=t}return t.prototype.align=function(t,i,n){var s=t;if(0===this.K.mode)return s;var h=n.defaultPriceScale(),r=h.firstValue();if(null===r)return s;var u=h.priceToCoordinate(t,r),e=n.dataSources().filter((function(t){return t instanceof wi})).reduce((function(t,s){if(n.isOverlay(s))return t;var h=s.priceScale(),r=s.bars();if(h.isEmpty()||!r.contains(i))return t;var u=r.valueAt(i);if(null===u)return t;var e=[u.plot.value[3]],o=a(s.firstValue());return t.concat(e.map((function(t){return h.priceToCoordinate(t,o.value,!0)})))}),[]);if(0===e.length)return s;e.sort((function(t,i){return Math.abs(t-u)-Math.abs(i-u)}));var o=e[0];return s=h.coordinateToPrice(o,r)},t}(),Fi=function(){function t(t,i){this.fn=[],this.Hn=[],this.Gi=0,this.Jt=0,this.Yn=1e3,this.Jn=null,this.an=null,this.Kn={},this.$n=new G,this.Xn=t,this.V=i,this.model().mainPriceScaleOptionsChanged().subscribe(this.onPriceScaleOptionsChanged.bind(this),this),this._n=this.Zn()}return t.prototype.onPriceScaleOptionsChanged=function(){this._n.applyOptions(this.V.options().priceScale)},t.prototype.destroy=function(){this.model().mainPriceScaleOptionsChanged().unsubscribeAll(this),this.Xn.barSpacingChanged().unsubscribeAll(this),this._n.modeChanged().unsubscribeAll(this),this.fn.forEach((function(t){t.destroy&&t.destroy()})),this.$n.fire()},t.prototype.stretchFactor=function(){return this.Yn},t.prototype.setStretchFactor=function(t){this.Yn=t},t.prototype.model=function(){return this.V},t.prototype.width=function(){return this.Jt},t.prototype.height=function(){return this.Gi},t.prototype.setWidth=function(t){this.Jt=t,this.updateAllViews()},t.prototype.setHeight=function(t){var i=this;this.Gi=t,this._n.setHeight(t),this.fn.forEach((function(n){if(i.isOverlay(n)){var s=n.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllViews()},t.prototype.dataSources=function(){return this.fn},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this._n!==i},t.prototype.addDataSource=function(t,i,n,s){var h=this.Gn().minZOrder-1;this.Qn(t,i,h,s)},t.prototype.removeDataSource=function(t){var i=this.fn.indexOf(t);e(-1!==i,"removeDataSource: invalid data source"),this.fn.splice(i,1),t===this.Jn&&(this.Jn=null);var n=this.Hn.indexOf(t);-1!==n&&this.Hn.splice(n,1);var s=t.priceScale();if(s&&s.dataSources().indexOf(t)>=0&&s.removeDataSource(t),s&&null===s.mainSource()){var h=s.dataSources().length;e(0===h,"Invalid priceScale state: empty mainSource but non-empty data sources="+h),s!==this._n&&s.modeChanged().unsubscribeAll(this)}t instanceof Q&&this.ts(),s&&t instanceof Q&&(s.invalidateSourcesCache(),this.recalculatePriceScale(s)),this.an=null},t.prototype.priceScalePosition=function(){var t=this.V.options().priceScale.position;return"none"===t?"overlay":t},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllViews()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllViews()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.setPriceAutoScale=function(t,i){t.setMode({autoScale:i}),this.Xn.isEmpty()?t.setPriceRange(null):this.recalculatePriceScale(t)},t.prototype.updateAllViews=function(){this.fn.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=this.mainDataSource(),i=null!==t?t.priceScale():null;return null===i&&(i=this._n),i},t.prototype.mainDataSource=function(){return this.Jn},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.ns(t)},t.prototype.resetPriceScale=function(t){var i=this.Xn.visibleBars();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllViews()},t.prototype.momentaryAutoScale=function(){this.ns(this._n)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this._n),this.fn.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllViews(),this.V.updatePane(this)},t.prototype.isEmpty=function(){return null===this.Jn},t.prototype.containsSeries=function(){return this.fn.some((function(t){return t instanceof wi}))},t.prototype.orderedSources=function(){return null===this.an&&(this.an=bi(this.fn)),this.an},t.prototype.onDestroyed=function(){return this.$n},t.prototype.ss=function(t,i,n){return"overlay"!==i?this._n:n?(this.Kn[n]||(this.Kn[n]=this.Zn()),this.Kn[n]):this.Zn()},t.prototype.ns=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.Xn.isEmpty()){var n=this.Xn.visibleBars();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.Gn=function(){var t=this.orderedSources();if(0===t.length)return{minZOrder:0,maxZOrder:0};for(var i=0,n=0,s=0;s<t.length;s++){var h=t[s].zorder();null!==h&&(h<i&&(i=h),h>n&&(n=h))}return{minZOrder:i,maxZOrder:n}},t.prototype.Qn=function(t,i,n,s){var h="overlay",r=null;if(!i){var u=this.model().options().priceScale.position;h="none"===u?"overlay":u}t instanceof Q&&(r=this.ss(t,h,s)),this.fn.push(t),i&&this.Hn.push(t),null!==r&&(r.addDataSource(t),t.setPriceScale(r)),t.setZorder(n),this.ts(),t instanceof Q&&this.recalculatePriceScale(r),this.an=null},t.prototype.hs=function(t,i,n){i.mode!==n.mode&&this.ns(t)},t.prototype.ts=function(){if(null===this.Jn||-1!==this.Hn.indexOf(this.Jn)){for(var t=0,i=this.fn;t<i.length;t++){if((h=i[t])instanceof Q&&!this.isOverlay(h))return void this.rs(h)}for(var n=0,s=this.Hn;n<s.length;n++){var h;if((h=s[n])instanceof Q)return void this.rs(h)}}},t.prototype.rs=function(t){var i=f(t.priceScale());this.defaultPriceScale().modeChanged().unsubscribeAll(this),i.modeChanged().subscribe(this.hs.bind(this,i),this),this.Jn=t},t.prototype.Zn=function(){var t=new Mi(b(this.V.options().priceScale),this.V.options().layout,this.V.options().localization);return t.setHeight(this.height()),t},t}(),Ii=function(t){return t.getUTCFullYear()},Pi=function(t){return $(function(t){return t.getUTCDate()}(t),2)},Wi=function(t){return $(function(t){return t.getUTCMonth()+1}(t),2)},Ri=function(t){return $(Ii(t)%100,2)},Ui=function(t){return $(Ii(t),4)},qi={"dd MMM 'yy":function(t,i){return Pi(t)+" "+function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,i)+" '"+Ri(t)},"yyyy-MM-dd":function(t,i){return Ui(t)+"-"+Wi(t)+"-"+Pi(t)},"yy-MM-dd":function(t,i){return Ri(t)+"-"+Wi(t)+"-"+Pi(t)},"yy/MM/dd":function(t,i){return Ri(t)+"/"+Wi(t)+"/"+Pi(t)},"yyyy/MM/dd":function(t,i){return Ui(t)+"/"+Wi(t)+"/"+Pi(t)},"dd-MM-yyyy":function(t,i){return Pi(t)+"-"+Wi(t)+"-"+Ui(t)},"dd-MM-yy":function(t,i){return Pi(t)+"-"+Wi(t)+"-"+Ri(t)},"dd/MM/yy":function(t,i){return Pi(t)+"/"+Wi(t)+"/"+Ri(t)},"dd/MM/yyyy":function(t,i){return Pi(t)+"/"+Wi(t)+"/"+Ui(t)},"MM/dd/yy":function(t,i){return Wi(t)+"/"+Pi(t)+"/"+Ri(t)},"MM/dd/yyyy":function(t,i){return Wi(t)+"/"+Pi(t)+"/"+Ui(t)}},Hi=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.us=qi[t],this.es=i}return t.prototype.format=function(t){return this.us(t,this.es)},t}(),Yi=function(){function t(t){this.os=t||"%h:%m:%s"}return t.prototype.format=function(t){return this.os.replace("%h",$(t.getUTCHours(),2)).replace("%m",$(t.getUTCMinutes(),2)).replace("%s",$(t.getUTCSeconds(),2))},t}(),Ji={dateFormat:"yyyy-MM-dd",timeFormat:"%h:%m:%s",dateTimeSeparator:" ",locale:"default"},Ki=function(){function t(t){void 0===t&&(t={});var i=u({},Ji,t);this.fs=new Hi(i.dateFormat,i.locale),this.as=new Yi(i.timeFormat),this.cs=i.dateTimeSeparator}return t.prototype.format=function(t){return""+this.fs.format(t)+this.cs+this.as.format(t)},t}(),$i=function(){function t(t,i){e(t<=i,"The last bar in the bars range should be greater than or equal to the first bar"),this.ls=t,this.vs=i}return t.prototype.firstBar=function(){return this.ls},t.prototype.lastBar=function(){return this.vs},t.prototype.count=function(){return this.vs-this.ls+1},t.prototype.contains=function(t){return this.ls<=t&&t<=this.vs},t.prototype.equals=function(t){return this.ls===t.firstBar()&&this.vs===t.lastBar()},t}(),Xi=function(){function t(t,i){void 0===i&&(i=50),this.Ft=0,this.It=1,this.Pt=1,this.Rt=new Map,this.Wt=new Map,this.ds=t,this.Ut=i}return t.prototype.format=function(t){var i=this.Rt.get(t.valueOf());if(void 0!==i)return i.string;if(this.Ft===this.Ut){var n=this.Wt.get(this.Pt);this.Wt.delete(this.Pt),this.Rt.delete(o(n)),this.Pt++,this.Ft--}var s=this.ds(t);return this.Rt.set(t.valueOf(),{string:s,tick:this.It}),this.Wt.set(this.It,t.valueOf()),this.Ft++,this.It++,s},t}();function _i(t,i){return t.index-i.index}var Zi,Gi,Qi=function(){function t(){this.ws=1/0,this.bs=-1/0,this.ms=new Map,this.gs=[],this.Ms=new G,this.Rt=null,this.ps=NaN}return t.prototype.reset=function(){this.ms.clear(),this.gs=[],this.ws=1/0,this.bs=-1/0,this.Rt=null,this.Ms.fire()},t.prototype.merge=function(t){for(var i=this.gs,n={},s=0,h=t;s<h.length;s++){var r=h[s],u=r.index,e=r.span,o=this.ms.get(r.index);if(o){if(o.index===r.index&&o.span===r.span){o.time=r.time;continue}this.ys(o)}this.ms.set(u,r),this.ws>u&&(this.ws=u),this.bs<u&&(this.bs=u),void 0===(f=i[e])&&(f=[],i[e]=f),f.push(r),n[e]=!0}for(e=i.length;e--;){var f;void 0!==(f=i[e])&&(0===f.length&&delete i[e],n[e]&&f.sort(_i))}this.Rt=null,this.Ms.fire()},t.prototype.indexToTime=function(t){var i=this.ms.get(t);return void 0===i?null:i.time},t.prototype.nearestIndex=function(t){for(var i=this.ws,n=this.bs;n-i>=2;){if(1e3*o(this.ms.get(i)).time.timestamp===t)return i;if(1e3*o(this.ms.get(n)).time.timestamp===t)return n;var s=Math.round((i+n)/2);1e3*o(this.ms.get(s)).time.timestamp>t?n=s:i=s}return t>(1e3*o(this.ms.get(i)).time.timestamp+1e3*o(this.ms.get(n)).time.timestamp)/2?n:i},t.prototype.build=function(t,i){var n=Math.ceil(i/t);if(this.ps===n&&this.Rt)return this.Rt;this.ps=n;for(var s=[],h=this.gs.length;h--;)if(this.gs[h]){var r=s;s=[];for(var u=r.length,e=0,f=o(this.gs[h]),a=f.length,c=1/0,l=-1/0,v=0;v<a;v++){for(var d=f[v],w=d.index;e<u;){var b=r[e],m=b.index;if(!(m<w)){c=m;break}e++,s.push(b),l=m,c=1/0}c-w>=n&&w-l>=n&&(s.push(d),l=w)}for(;e<u;e++)s.push(r[e])}return this.Rt=s,this.Rt},t.prototype.ys=function(t){var i=t.index;if(this.ms.get(i)===t){this.ms.delete(i),i<=this.ws&&this.ws++,i>=this.bs&&this.bs--,this.bs<this.ws&&(this.ws=1/0,this.bs=-1/0);var n=o(this.gs[t.span]),s=n.indexOf(t);-1!==s&&n.splice(s,1)}},t}(),tn=function(){function t(){this.ai=[]}return t.prototype.clear=function(){this.ai=[]},t.prototype.size=function(){return this.ai.length},t.prototype.firstIndex=function(){return this.ks(0)},t.prototype.lastIndex=function(){return this.ks(this.ai.length-1)},t.prototype.merge=function(t,i){if(0!==i.length)if(0!==this.ai.length){var n=t;if(n<0){var s=Math.abs(n);if(i.length<s)return;this.ai=new Array(s).concat(this.ai);for(var h=0;h<i.length;++h)this.ai[t+h]=i[h]}else{for(var r=n;r<this.ai.length&&r-n<i.length;++r)this.ai[r]=i[r-n];var u=n+i.length;if(u>this.ai.length){s=u-this.ai.length;for(var e=r;e<r+s;++e)this.ai.push(i[e-n])}}}else this.ai=i},t.prototype.valueAt=function(t){var i=this.Ns(t);return null!==i?this.ai[i]:null},t.prototype.indexOf=function(t,i){if(this.ai.length<1)return null;if(t>this.ai[this.ai.length-1].timestamp)return i?this.ai.length-1:null;for(var n=0;n<this.ai.length;++n){if(t===this.ai[n].timestamp)return n;if(t<this.ai[n].timestamp)return i?n:null}return null},t.prototype.closestIndexLeft=function(t){var i=this.ai;if(!i.length)return null;if(Number.isNaN(t.timestamp))return null;var n=i.length-1;if(t>=i[n])return n;var s=0,h=i[s];if(t<h)return null;if(t===h)return s;for(;n>s+1;){var r=s+n>>1,u=i[r];if(u.timestamp>t.timestamp)n=r;else{if(!(u.timestamp<t.timestamp))return u.timestamp===t.timestamp?r:null;s=r}}return s},t.prototype.ks=function(t){return 0<=t&&t<this.size()?t:null},t.prototype.Ns=function(t){return 0<=t&&t<this.size()?t:null},t}();!function(t){t[t.DefaultAnimationDuration=400]="DefaultAnimationDuration",t[t.MaxBarSpacing=50]="MaxBarSpacing",t[t.MinBarSpacing=.5]="MinBarSpacing",t[t.MinVisibleBarsCount=5]="MinVisibleBarsCount"}(Zi||(Zi={})),function(t){t[t.Minute=20]="Minute",t[t.Hour=30]="Hour",t[t.Day=40]="Day",t[t.Week=50]="Week",t[t.Month=60]="Month",t[t.Year=70]="Year"}(Gi||(Gi={}));var nn=function(){function t(t,i,n){this.Jt=0,this.Ss=null,this.xs=new tn,this.Cs=new G,this.wn=null,this.dn=null,this.Ds=new Qi,this.Os=new Map,this.Es=null,this.Ts=!0,this.Ls=new G,this.As=new G,this.Bs=null,this.zs=null,this.Vs=null,this.js=[],this.K=i,this.gn=n,this.Fs=i.rightOffset,this.Is=sn(i.barSpacing),this.V=t,this.Ps()}return t.prototype.options=function(){return this.K},t.prototype.applyLocalizationOptions=function(t){c(this.gn,t),this.Ws(),this.Ps()},t.prototype.applyOptions=function(t,i){c(this.K,t),this.K.fixLeftEdge?this.Rs():this.Bs=null,void 0!==t.rightOffset&&this.setRightOffset(t.rightOffset),void 0!==t.barSpacing&&this.setBarSpacing(t.barSpacing),this.Ws(),this.Ps(),this.As.fire()},t.prototype.isEmpty=function(){return 0===this.Jt||0===this.xs.size()},t.prototype.visibleBars=function(){return this.Ts&&(this.Ts=!1,this.Us()),this.Es},t.prototype.tickMarks=function(){return this.Ds},t.prototype.points=function(){return this.xs},t.prototype.width=function(){return this.Jt},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.Jt!==t){if(this.K.lockVisibleTimeRangeOnResize&&this.Jt){var i=this.Is*t/this.Jt;this.qs(i)}if(null!==this.Bs)if(f(this.visibleBars()).firstBar()<=this.Bs){var n=this.Jt-t;this.Fs-=Math.round(n/this.Is)+1}this.Jt=t,this.Ts=!0,this.Hs()}},t.prototype.indexToCoordinate=function(t,i){if(this.isEmpty()||!v(t))return 0;var n=this.baseIndex()+this.Fs-t,s=this.Jt-(n+.5)*this.Is;return i?s:Math.round(s)},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),s=void 0===i?0:i.from,h=void 0===i?t.length:i.to,r=s;r<h;r++){var u=t[r].time,e=n+this.Fs-u,o=this.Jt-(e+.5)*this.Is;t[r].x=Math.round(o)}},t.prototype.indexToUserTime=function(t){return this.Ds.indexToTime(t)},t.prototype.timeToCoordinate=function(t){if(this.isEmpty()||!v(t))return 0;var i=this.Ds.nearestIndex(t);return this.indexToCoordinate(i)},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.Ys(t))},t.prototype.setRightOffset=function(t){this.Ts=!0,this.Fs=t,this.Hs(),this.V.recalculateAllPanes(),this.V.lightUpdate()},t.prototype.barSpacing=function(){return this.Is},t.prototype.setBarSpacing=function(t){this.qs(t),this.Hs()},t.prototype.barSpacingChanged=function(){return this.Cs},t.prototype.rightOffset=function(){return this.Fs},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.Vs)return this.Vs;for(var t=this.Is,i=5*(this.V.options().layout.fontSize+4),n=Math.round(i/t),s=f(this.visibleBars()),h=Math.max(s.firstBar(),s.firstBar()-n),r=Math.max(s.lastBar(),s.lastBar()-n),u=0,e=0,o=this.Ds.build(t,i);e<o.length;e++){var a=o[e];if(h<=a.index&&a.index<=r){var c=this.Ds.indexToTime(a.index);if(null!==c){if(u<this.js.length){var l=this.js[u];l.coord=this.indexToCoordinate(a.index),l.label=this.Js(c,a.span),l.span=a.span,l.major=!1}else this.js.push({coord:this.indexToCoordinate(a.index),label:this.Js(c,a.span),span:a.span,major:!1});u++}}}return this.js.length=u,this.Vs=this.js,this.js},t.prototype.reset=function(){this.Ts=!0,this.xs=new tn,this.wn=null,this.dn=null,this.Ks(),this.Ds.reset(),this.Bs=null},t.prototype.restoreDefault=function(){this.Ts=!0,this.setBarSpacing(this.K.barSpacing),this.setRightOffset(this.K.rightOffset)},t.prototype.fixLeftEdge=function(){return this.K.fixLeftEdge},t.prototype.setBaseIndex=function(t){this.Ts=!0,this.Ss=t,this.Hs(),this.Rs()},t.prototype.zoom=function(t,i){var n=this.Ys(t),s=this.barSpacing(),h=s+i*(s/10);this.setBarSpacing(h),this.K.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.Ys(t)))},t.prototype.startScale=function(t){this.wn&&this.endScroll(),null===this.dn&&null===this.zs&&(this.isEmpty()||(this.dn=t,this.$s()))},t.prototype.scaleTo=function(t){if(null!==this.zs){var i=it(this.Jt-t,0,this.Jt),n=it(this.Jt-f(this.dn),0,this.Jt);0!==i&&0!==n&&this.setBarSpacing(this.zs.barSpacing*i/n)}},t.prototype.endScale=function(){null!==this.dn&&(this.dn=null,this.Ks())},t.prototype.startScroll=function(t){null===this.wn&&null===this.zs&&(this.isEmpty()||(this.wn=t,this.$s()))},t.prototype.scrollTo=function(t){if(this.Ts=!0,null!==this.wn){var i=(this.wn-t)/this.barSpacing();this.Fs=f(this.zs).rightOffset+i,this.Ts=!0,this.Hs()}},t.prototype.endScroll=function(){null!==this.wn&&(this.wn=null,this.Ks())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.K.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var s=this.Fs,h=(new Date).getTime(),r=function(){var u=((new Date).getTime()-h)/i,e=u>=1,o=e?t:s+(t-s)*u;n.setRightOffset(o),e||setTimeout(r,20)};r()},t.prototype.update=function(t,i,n){if(this.Ts=!0,i.length>0){var s=this.xs.size();this.xs.merge(t,i),this.Fs<0&&this.xs.size()===s+1&&(this.Fs-=1,this.Ts=!0)}this.Ds.merge(n),this.Hs()},t.prototype.visibleBarsChanged=function(){return this.Ls},t.prototype.optionsApplied=function(){return this.As},t.prototype.baseIndex=function(){return this.Ss||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.qs(this.Jt/i),this.Fs=t.lastBar()-this.baseIndex(),this.Hs(),this.Ts=!0,this.V.recalculateAllPanes(),this.V.lightUpdate()},t.prototype.fitContent=function(){var t=this.xs.firstIndex(),i=this.xs.lastIndex();null!==t&&null!==i&&this.setVisibleRange(new $i(t-1,i+1+this.K.rightOffset))},t.prototype.setTimePointsRange=function(t){var i=this.points(),n=i.firstIndex(),s=i.lastIndex();if(null!==n&&null!==s){var h=f(i.valueAt(n)).timestamp,r=f(i.valueAt(s)).timestamp,u=new $i(f(i.indexOf(Math.max(h,t.from.timestamp),!0)),f(i.indexOf(Math.min(r,t.to.timestamp),!0)));this.setVisibleRange(u)}},t.prototype.formatDateTime=function(t){return void 0!==this.gn.timeFormatter?this.gn.timeFormatter(t.businessDay||t.timestamp):this.Xs.format(new Date(1e3*t.timestamp))},t.prototype._s=function(t){return(this.Jt+1-t)/this.Is},t.prototype.Ys=function(t){var i=this._s(t),n=this.baseIndex()+this.Fs-i;return Math.round(1e6*n)/1e6},t.prototype.qs=function(t){t=sn(t);var i=this.Is;i!==t&&(this.Ts=!0,this.Is=t,this.Cs.fire(i,t),this.Zs())},t.prototype.Us=function(){if(this.isEmpty())this.Gs(null);else{var t=this.baseIndex(),i=Math.ceil(this.Jt/this.Is)-1,n=Math.round(this.Fs+t),s=n-i;this.Gs(new $i(s,n))}},t.prototype.Hs=function(){var t=this.Qs();this.Fs>t&&(this.Fs=t,this.Ts=!0);var i=this.th();null!==i&&this.Fs<i&&(this.Fs=i,this.Ts=!0)},t.prototype.th=function(){var t=this.xs.firstIndex(),i=this.Ss;if(null===t||null===i)return null;if(null!==this.Bs){var n=this.Jt/this.Is;return this.Bs-i+n-1}return t-i-1+5},t.prototype.Qs=function(){return this.Jt/this.Is-5},t.prototype.$s=function(){this.zs={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}},t.prototype.Ks=function(){this.zs=null},t.prototype.Js=function(t,i){var n=this,s=this.Os.get(i);return void 0===s&&(s=new Xi((function(t){return n.ih(t,i)})),this.Os.set(i,s)),void 0===t.businessDay?s.format(new Date(1e3*t.timestamp)):s.format(new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)))},t.prototype.ih=function(t,i){var n={},s=this.K.timeVisible;return i<20&&s?(n.hour12=!1,n.hour="2-digit",n.minute="2-digit",this.K.secondsVisible&&(n.second="2-digit")):i<40&&s?(n.hour12=!1,n.hour="2-digit",n.minute="2-digit"):i<50?n.day="numeric":i<60?n.day="numeric":i<70?n.month="short":n.year="numeric",new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()).toLocaleString(this.gn.locale,n)},t.prototype.Gs=function(t){if(null!==t||null!==this.Es){var i=this.Es;this.Es=t,(null===this.Es||null!==i&&!this.Es.equals(i))&&this.Ls.fire(),this.Zs()}},t.prototype.Zs=function(){this.Vs=null},t.prototype.Ws=function(){this.Zs(),this.Os.clear()},t.prototype.Ps=function(){var t=this.gn.dateFormat;this.K.timeVisible?this.Xs=new Ki({dateFormat:t,timeFormat:this.K.secondsVisible?"%h:%m:%s":"%h:%m",dateTimeSeparator:"   ",locale:this.gn.locale}):this.Xs=new Hi(t,this.gn.locale)},t.prototype.Rs=function(){if(this.K.fixLeftEdge){var t=this.xs.firstIndex();if(null!==t&&this.Bs!==t){this.Bs=t;var i=f(this.visibleBars()).firstBar()-t;if(i<0){var n=this.Fs-i-1;this.setRightOffset(n)}}}},t}();function sn(t){return t<.5?.5:t>50?50:t}var hn=function(){function t(t){this.nh=new Map,this.g=t}return t.prototype.draw=function(t){},t.prototype.drawBackground=function(t){if(this.g.visible){t.save();for(var i=0,n=0,s=this.g.lines;n<s.length;n++){if(0!==(o=s[n]).text.length){t.font=o.font;var h=this.sh(t,o.text);h>this.g.width?o.zoom=this.g.width/h:o.zoom=1,i+=o.lineHeight*o.zoom}}var r=0;switch(this.g.vertAlign){case"top":r=0;break;case"center":r=Math.max((this.g.height-i)/2,0);break;case"bottom":r=Math.max(this.g.height-i,0)}t.fillStyle=this.g.color;for(var u=0,e=this.g.lines;u<e.length;u++){var o=e[u];t.save();var f=0;switch(this.g.horzAlign){case"left":t.textAlign="left",f=o.lineHeight/2;break;case"center":t.textAlign="center",f=this.g.width/2;break;case"right":t.textAlign="right",f=this.g.width-1-o.lineHeight/2}t.translate(f,r),t.textBaseline="top",t.font=o.font,t.scale(o.zoom,o.zoom),t.fillText(o.text,0,o.vertOffset),t.restore(),r+=o.lineHeight*o.zoom}t.restore()}},t.prototype.sh=function(t,i){var n=this.hh(t.font),s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s},t.prototype.hh=function(t){var i=this.nh.get(t);return void 0===i&&(i=new Map,this.nh.set(t,i)),i},t}(),rn=function(){function t(t){this.o=!0,this.M={visible:!1,color:"",height:0,width:0,lines:[],vertAlign:"center",horzAlign:"center"},this.p=new hn(this.M),this.k=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){return this.o&&(this.m(t,i),this.o=!1),this.p},t.prototype.m=function(t,i){var n=this.k.options(),s=this.M;s.visible=n.visible,s.visible&&(s.color=n.color,s.width=i,s.height=t,s.horzAlign=n.horzAlign,s.vertAlign=n.vertAlign,s.lines=[{text:n.text,font:Ei(n.fontSize),lineHeight:1.2*n.fontSize,vertOffset:0,zoom:0}])},t}(),un=function(t){function i(i,n){var s=t.call(this)||this;return s.K=n,s.Z=new rn(s),s}return r(i,t),i.prototype.paneViews=function(){return[this.Z]},i.prototype.options=function(){return this.K},i.prototype.updateAllViews=function(){this.Z.update()},i}(H),en=function(){function t(t,i){this.rh=[],this.uh=[],this.Jt=0,this.eh=null,this.oh=null,this.fh=new G,this.ah=new G,this.lh=t,this.K=i,this.vh=new Li(this),this.Xn=new nn(this,i.timeScale,this.K.localization),this.dh=new zi,this.v=new Y(this,i.crosshair),this.wh=new ji(i.crosshair),this.bh=new un(this,i.watermark),this.createPane(),this.rh[0].setStretchFactor(2e3),this.rh[0].addDataSource(this.bh,!0,!1)}return t.prototype.updatePane=function(t){var i=this.mh(t,0);this.gh(i)},t.prototype.fullUpdate=function(){this.gh(new Vi(3))},t.prototype.lightUpdate=function(){this.gh(new Vi(2))},t.prototype.updateSource=function(t){var i=this.Mh(t);this.gh(i)},t.prototype.hoveredSource=function(){return this.oh},t.prototype.setHoveredSource=function(t){var i=this.oh;this.oh=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.K},t.prototype.applyOptions=function(t){c(this.K,t),void 0!==t.priceScale&&(this.mainPriceScale().applyOptions(t.priceScale),this.fh.fire()),void 0!==t.timeScale&&this.Xn.applyOptions(t.timeScale),void 0!==t.localization&&(this.Xn.applyLocalizationOptions(t.localization),this.mainPriceScale().updateFormatter()),this.fullUpdate()},t.prototype.updateAllPaneViews=function(){this.rh.forEach((function(t){return t.updateAllViews()})),this.updateCrosshair()},t.prototype.timeScale=function(){return this.Xn},t.prototype.panes=function(){return this.rh},t.prototype.gridSource=function(){return this.dh},t.prototype.watermarkSource=function(){return this.bh},t.prototype.crosshairSource=function(){return this.v},t.prototype.crosshairMoved=function(){return this.ah},t.prototype.width=function(){return this.Jt},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.setWidth=function(t){this.Jt=t,this.Xn.setWidth(this.Jt),this.rh.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new Fi(this.Xn,this);void 0!==t?this.rh.splice(t,0,i):this.rh.push(i);var n=void 0===t?this.rh.length-1:t,s=new Vi(3);return s.invalidatePane(n,{level:0,autoScale:!0}),this.invalidate(s),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.gh(this.mh(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.gh(this.mh(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.gh(this.mh(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.gh(this.mh(t,2)))},t.prototype.setPriceAutoScale=function(t,i,n){t.setPriceAutoScale(i,n),this.gh(this.mh(t,2))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.gh(this.mh(t,2))},t.prototype.startScaleTime=function(t){this.Xn.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var s=n.width();t=Math.max(1,Math.min(t,s)),n.zoom(t,i),this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.Xn.scaleTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.endScaleTime=function(){this.Xn.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.eh=t,this.Xn.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.eh&&Math.abs(t-this.eh)>20&&(this.eh=null,i=!0),this.Xn.scrollTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate(),i},t.prototype.endScrollTime=function(){this.Xn.endScroll(),this.lightUpdate(),this.eh=null},t.prototype.resetTimeScale=function(){this.Xn.restoreDefault(),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.invalidate=function(t){this.lh&&this.lh(t),this.dh.invalidate(),this.lightUpdate()},t.prototype.dataSources=function(){return this.rh.reduce((function(t,i){return t.concat(i.dataSources())}),[])},t.prototype.serieses=function(){return this.uh},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.v.saveOriginCoord(t,i);var s=NaN,h=this.Xn.coordinateToIndex(t),r=this.Xn.visibleBars();if(null!==r&&(h=Math.min(Math.max(r.firstBar(),h),r.lastBar())),null!==n.mainDataSource()){var u=n.defaultPriceScale(),e=u.firstValue();null!==e&&(s=u.coordinateToPrice(i,e)),s=this.wh.align(s,h,n)}this.v.setPosition(h,s,n),this.ph(),this.ah.fire(this.v.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.ph(),this.ah.fire(null,null)},t.prototype.updateCrosshair=function(){var t=this.v.pane();if(null!==t){var i=this.v.originCoordX(),n=this.v.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}},t.prototype.updateTimeScale=function(t,i,n,s){s&&this.Xn.reset(),this.Xn.update(t,i,n)},t.prototype.updateTimeScaleBaseIndex=function(t){var i=this.uh.reduce((function(t,i){var n=i.bars();if(n.isEmpty())return t;var s=f(n.lastIndex());return void 0===t?s:Math.max(s,t)}),void 0);if(void 0!==i){var n=this.Xn,s=n.baseIndex(),h=n.visibleBars();if(null!==h){var r=h.contains(s);if(void 0!==t&&t>0&&!r){var u=i-s;n.setRightOffset(n.rightOffset()-u)}}n.setBaseIndex(i)}this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.rh.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.rh.forEach((function(t){return t.recalculate()})),this.updateAllPaneViews()},t.prototype.destroy=function(){this.rh.forEach((function(t){return t.destroy()})),this.rh.length=0,this.K.localization.priceFormatter=void 0,this.K.localization.timeFormatter=void 0},t.prototype.setPriceAutoScaleForAllMainSources=function(){this.rh.map((function(t){return t.mainDataSource()})).forEach((function(t){null!==t&&f(t.priceScale()).setMode({autoScale:!0})}))},t.prototype.rendererOptionsProvider=function(){return this.vh},t.prototype.priceAxisRendererOptions=function(){return this.vh.options()},t.prototype.mainPriceScaleOptionsChanged=function(){return this.fh},t.prototype.mainPriceScale=function(){return this.rh[0].defaultPriceScale()},t.prototype.createSeries=function(t,i){var n=this.rh[0],s=this.yh(i,t,n);return this.uh.push(s),1===this.uh.length?this.fullUpdate():this.lightUpdate(),s},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.uh.indexOf(t);e(-1!==n,"Series not found"),this.uh.splice(n,1),f(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.fitContent=function(){var t=new Vi(2);t.setFitContent(),this.gh(t)},t.prototype.setTargetTimeRange=function(t){var i=new Vi(2);i.setTargetTimeRange(t),this.gh(i)},t.prototype.mh=function(t,i){var n=new Vi(i);if(null!==t){var s=this.rh.indexOf(t);n.invalidatePane(s,{level:i})}return n},t.prototype.Mh=function(t,i){return void 0===i&&(i=2),this.mh(this.paneForSource(t),i)},t.prototype.gh=function(t){this.lh&&this.lh(t),this.dh.invalidate()},t.prototype.ph=function(){this.gh(new Vi(1))},t.prototype.yh=function(t,i,n){var s=new wi(this,t,i);return n.addDataSource(s,Boolean(t.overlay),!1,t.scaleGroup),t.overlay&&s.applyOptions(t),s},t}(),on=function(){function t(t,i){this.w=t,this.h=i}return t.prototype.equals=function(t){return this.w===t.w&&this.h===t.h},t}();function fn(t,i){t.width=i.w,t.height=i.h;var n=Ci(t);n&&n.translate(.5,.5)}function an(t,i,n,s,h,r){t.save(),t.translate(-.5,-.5),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,h),t.restore()}function cn(t,i){var n=document.createElement("canvas");return t.appendChild(n),fn(n,i),function(t){t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.MozUserSelect="none",t.style.webkitTapHighlightColor="transparent"}(n),n}var ln,vn=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch),dn="onorientationchange"in window&&vn,wn=/Android/i.test(navigator.userAgent),bn=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent),mn=wn||bn;!function(t){t[t.ResetClick=500]="ResetClick",t[t.LongTap=240]="LongTap"}(ln||(ln={}));var gn=function(){function t(t,i,n){this.kh=0,this.Nh=null,this.Sh=null,this.xh=!1,this.Ch=null,this.Dh=!1,this.Oh=!1,this.Eh=null,this.Th=null,this.Lh=null,this.Ah=null,this.Bh=0,this.zh=!1,this.Vh=!1,this.jh=!1,this.Fh=t,this.Ih=i,this.K=n,this.Ph()}return t.prototype.destroy=function(){null!==this.Eh&&(this.Eh(),this.Eh=null),null!==this.Th&&(this.Th(),this.Th=null),null!==this.Lh&&(this.Lh(),this.Lh=null),this.Wh(),this.Rh()},t.prototype.Uh=function(t){var i=this;this.Th&&this.Th();var n=this.qh.bind(this);this.Th=function(){i.Fh.removeEventListener("mousemove",n)},this.Fh.addEventListener("mousemove",n),yn(t)&&this.qh(t);var s=this.Hh(t);this.Yh(s,this.Ih.mouseEnterEvent)},t.prototype.Rh=function(){null!==this.Nh&&clearTimeout(this.Nh),this.kh=0,this.Nh=null},t.prototype.qh=function(t){if(!this.jh||yn(t)){var i=this.Hh(t);this.Yh(i,this.Ih.mouseMoveEvent)}},t.prototype.Jh=function(t){if(!("button"in t&&0!==t.button)&&null===this.Ah){var i=yn(t);if(!this.Vh||!i){this.zh=!0;var n=this.Hh(t),s=a(this.Ch),h=Math.abs(s.x-n.pageX),r=Math.abs(s.y-n.pageY),u=h+r>5;if(u||!i){if(u&&!this.Dh&&i){var e=.5*h,o=r>=e&&!this.K.treatVertTouchDragAsPageScroll,f=e>r&&!this.K.treatHorzTouchDragAsPageScroll;o||f||(this.Vh=!0)}u&&(this.Dh=!0,this.Oh=!0,i&&this.Wh()),this.Vh||(this.Yh(n,this.Ih.pressedMouseMoveEvent),i&&kn(t))}}}},t.prototype.Kh=function(t){if(!("button"in t&&0!==t.button)){var i=this.Hh(t);this.Wh(),this.Ch=null,this.jh=!1,this.Lh&&(this.Lh(),this.Lh=null),yn(t)&&this.$h(t),this.Yh(i,this.Ih.mouseUpEvent),++this.kh,this.Nh&&this.kh>1?(this.Yh(i,this.Ih.mouseDoubleClickEvent),this.Rh()):this.Oh||this.Yh(i,this.Ih.mouseClickEvent),yn(t)&&(kn(t),this.$h(t),0===t.touches.length&&(this.xh=!1))}},t.prototype.Wh=function(){null!==this.Sh&&(clearTimeout(this.Sh),this.Sh=null)},t.prototype.Xh=function(t){if(!("button"in t&&0!==t.button)){var i=this.Hh(t);this.Oh=!1,this.Dh=!1,this.Vh=!1,yn(t)&&this.Uh(t),this.Ch={x:i.pageX,y:i.pageY},this.Lh&&(this.Lh(),this.Lh=null);var n=this.Jh.bind(this),s=this.Kh.bind(this),h=this.Fh.ownerDocument.documentElement;this.Lh=function(){h.removeEventListener("touchmove",n),h.removeEventListener("touchend",s),h.removeEventListener("mousemove",n),h.removeEventListener("mouseup",s)},h.addEventListener("touchmove",n,{passive:!1}),h.addEventListener("touchend",s,{passive:!1}),this.Wh(),yn(t)&&1===t.touches.length?this.Sh=setTimeout(this._h.bind(this,t),240):(h.addEventListener("mousemove",n),h.addEventListener("mouseup",s)),this.jh=!0,this.Yh(i,this.Ih.mouseDownEvent),this.Nh||(this.kh=0,this.Nh=setTimeout(this.Rh.bind(this),500))}},t.prototype.Ph=function(){var t=this;this.Fh.addEventListener("mouseenter",this.Uh.bind(this)),this.Fh.addEventListener("touchcancel",this.Wh.bind(this));var i=this.Fh.ownerDocument,n=function(i){t.Ih.mouseDownOutsideEvent&&(i.target&&t.Fh.contains(i.target)||t.Ih.mouseDownOutsideEvent())};this.Eh=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this.Fh.addEventListener("mouseleave",this.$h.bind(this)),this.Fh.addEventListener("touchstart",this.Xh.bind(this),{passive:!0}),dn||this.Fh.addEventListener("mousedown",this.Xh.bind(this)),this.Zh(),this.Fh.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.Zh=function(){var t=this;void 0===this.Ih.pinchStartEvent&&void 0===this.Ih.pinchEvent&&void 0===this.Ih.pinchEndEvent||(this.Fh.addEventListener("touchstart",(function(i){return t.Gh(i.touches)}),{passive:!0}),this.Fh.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.Ah&&void 0!==t.Ih.pinchEvent){var n=pn(i.touches[0],i.touches[1])/t.Bh;t.Ih.pinchEvent(t.Ah,n),kn(i)}}),{passive:!1}),this.Fh.addEventListener("touchend",(function(i){t.Gh(i.touches)})))},t.prototype.Gh=function(t){1===t.length&&(this.zh=!1),2!==t.length||this.zh||this.xh?this.Qh():this.tr(t)},t.prototype.tr=function(t){var i=Mn(this.Fh);this.Ah={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Bh=pn(t[0],t[1]),void 0!==this.Ih.pinchStartEvent&&this.Ih.pinchStartEvent(),this.Wh()},t.prototype.Qh=function(){null!==this.Ah&&(this.Ah=null,void 0!==this.Ih.pinchEndEvent&&this.Ih.pinchEndEvent())},t.prototype.$h=function(t){this.Th&&this.Th();var i=this.Hh(t);this.Yh(i,this.Ih.mouseLeaveEvent)},t.prototype._h=function(t){var i=this.Hh(t);this.Yh(i,this.Ih.longTapEvent),this.Oh=!0,this.xh=!0},t.prototype.Yh=function(t,i){i&&i.call(this.Ih,t)},t.prototype.Hh=function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var n=Mn(this.Fh);return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-n.left,localY:i.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?"mouse":"touch",target:i.target,view:t.view}},t}();function Mn(t){return t.getBoundingClientRect()||{left:0,top:0}}function pn(t,i){var n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function yn(t){return Boolean(t.touches)}function kn(t){t.cancelable&&t.preventDefault()}var Nn,Sn=function(){function t(t,i,n,s){if(this.ir=0,this.nr=0,this.sr=0,this.hr=0,this.rr=0,this.ur=0,this.er=0,this.or=t,this.ar=t.paneWidgets()[i],this.cr=t.paneWidgets()[n],this.lr=document.createElement("tr"),this.lr.style.height="1px",this.vr=document.createElement("td"),this.vr.style.padding="0",this.vr.setAttribute("colspan","3"),this.dr(),this.lr.appendChild(this.vr),s)this.wr=null,this.br=null;else{this.wr=document.createElement("div"),this.wr.style.position="absolute",this.wr.style.zIndex="50",this.wr.style.height="5px",this.wr.style.width="100%",this.wr.style.backgroundColor="rgba(255, 255, 255, 0.02)",this.wr.style.cursor="ns-resize",this.vr.appendChild(this.wr);var h={mouseDownEvent:this.mr.bind(this),pressedMouseMoveEvent:this.gr.bind(this),mouseUpEvent:this.Mr.bind(this)};this.br=new gn(this.wr,h,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}}return t.prototype.destroy=function(){null!==this.br&&this.br.destroy()},t.prototype.getElement=function(){return this.lr},t.prototype.getImage=function(){var t=document.createElement("canvas"),i=this.ar.getSize().w;fn(t,new on(i,1));var n=f(Ci(t));return n.fillStyle=this.or.options().timeScale.borderColor,n.fillRect(0,0,i,1),t},t.prototype.update=function(){this.dr()},t.prototype.dr=function(){this.vr.style.background=this.or.options().timeScale.borderColor},t.prototype.mr=function(t){this.ir=t.pageY,this.nr=0,this.sr=this.ar.getSize().h+this.cr.getSize().h,this.hr=this.ar.stretchFactor()+this.cr.stretchFactor(),this.rr=30,this.ur=this.sr-this.rr,this.er=this.hr/this.sr},t.prototype.gr=function(t){this.nr=t.pageY-this.ir;var i=this.ar.getSize().h,n=it(i+this.nr,this.rr,this.ur)*this.er,s=this.hr-n;this.ar.setStretchFactor(n),this.cr.setStretchFactor(s),this.or.adjustSize(),this.ar.getSize().h!==i&&(this.ir=t.pageY)},t.prototype.Mr=function(t){this.ir=0,this.nr=0,this.sr=0,this.hr=0,this.rr=0,this.ur=0,this.er=0},t}(),xn=function(){function t(t,i,n,s){this.Kt=new Ft(200),this._t=0,this.pr="",this.yr="",this.kr=[],this.Nr=new Map,this._t=t,this.pr=i,this.yr=Ei(t,n,s)}return t.prototype.destroy=function(){delete this.Kt,this.kr=[],this.Nr.clear()},t.prototype.paintTo=function(t,i,n,s,h){var r=this.getLabelImage(t,i);"left"!==h&&(n-=r.textWidth),s-=Math.floor(r.height/2),t.drawImage(r.canvas,n,s)},t.prototype.getLabelImage=function(t,i){var n;if(this.Nr.has(i))n=o(this.Nr.get(i));else{if(this.kr.length>=200){var s=o(this.kr.shift());this.Nr.delete(s)}n={text:i,textWidth:0,width:0,height:0,canvas:document.createElement("canvas")};var h=Math.ceil(this._t/4.5),r=Math.round(this._t/10),u=Math.ceil(this.Kt.measureText(t,i));n.textWidth=Math.round(Math.max(1,u)),n.width=Math.round(u+2*h),n.height=this._t+2*h,0!==u&&(this.kr.push(n.text),this.Nr.set(n.text,n)),n.canvas.width=n.width,n.canvas.height=n.height,(t=f(Ci(n.canvas))).font=this.yr,t.fillStyle=this.pr,t.fillText(i,0,n.height-h-r)}return n},t}();!function(t){t[t.Default=0]="Default",t[t.NsResize=1]="NsResize"}(Nn||(Nn={}));var Cn,Dn,On=function(){function t(t,i,n,s){this.A=null,this.Sr=null,this.xr=null,this.Cr=!1,this.Dr=!0,this.Or=new Ft(50),this.Er=new xn(11,"#000"),this.pr=null,this.yr=null,this.Tr=0,this.F=t,this.K=i,this.vh=n,this.Lr="left"===s,this.vr=document.createElement("div"),this.vr.style.height="100%",this.vr.style.overflow="hidden",this.vr.style.width="25px",this.vr.style.left="0",this.vr.style.position="relative",this.Ar=cn(this.vr,new on(16,16)),this.Ar.style.position="absolute",this.Ar.style.zIndex="1",this.Ar.style.left="0",this.Ar.style.top="0",this.Ln=f(Ci(this.Ar)),this.Br=cn(this.vr,new on(16,16)),this.Br.style.position="absolute",this.Br.style.zIndex="2",this.Br.style.left="0",this.Br.style.top="0",this.zr=f(Ci(this.Br));var h={mouseDownEvent:this.mr.bind(this),pressedMouseMoveEvent:this.gr.bind(this),mouseDownOutsideEvent:this.Vr.bind(this),mouseUpEvent:this.Mr.bind(this),mouseDoubleClickEvent:this.jr.bind(this),mouseEnterEvent:this.Fr.bind(this),mouseLeaveEvent:this.Ir.bind(this)};this.br=new gn(this.Br,h,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}return t.prototype.destroy=function(){this.br.destroy(),null!==this.A&&(this.A.onMarksChanged().unsubscribeAll(this),this.A.optionsChanged().unsubscribeAll(this)),this.A=null,null!==this.xr&&(clearTimeout(this.xr),this.xr=null),this.Er.destroy()},t.prototype.getElement=function(){return this.vr},t.prototype.backgroundColor=function(){return this.K.backgroundColor},t.prototype.lineColor=function(){return this.F.chart().options().priceScale.borderColor},t.prototype.textColor=function(){return this.K.textColor},t.prototype.fontSize=function(){return this.K.fontSize},t.prototype.baseFont=function(){return Ei(this.fontSize(),this.K.fontFamily)},t.prototype.rendererOptions=function(){var t=this.vh.options(),i=this.pr!==t.color,n=this.yr!==t.font;return(i||n)&&(this.Pr(t),this.pr=t.color),n&&(this.Or.reset(),this.yr=t.font),t},t.prototype.optimalWidth=function(){if(!this.isVisible()||null===this.A)return 0;var t=34,i=this.rendererOptions(),n=this.Ln,s=this.A.marks();n.font=this.baseFont(),s.length>0&&(t=Math.max(this.Or.measureText(n,s[0].label),this.Or.measureText(n,s[s.length-1].label)));for(var h=this.Wr(),r=h.length;r--;){var u=this.Or.measureText(n,h[r].text());u>t&&(t=u)}return Math.ceil(i.offsetSize+i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+t)},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Sr&&this.Sr.equals(t)||(this.Sr=t,fn(this.Ar,t),fn(this.Br,t),this.vr.style.width=t.w+"px",this.vr.style.height=t.h+"px",this.vr.style.minWidth=t.w+"px")},t.prototype.getWidth=function(){return f(this.Sr).w},t.prototype.setPriceScale=function(t){this.A!==t&&(null!==this.A&&(this.A.onMarksChanged().unsubscribeAll(this),this.A.optionsChanged().unsubscribeAll(this)),this.A=t,t.onMarksChanged().subscribe(this.en.bind(this),this))},t.prototype.priceScale=function(){return this.A},t.prototype.isVisible=function(){return this.Dr},t.prototype.setVisible=function(t){t!==this.Dr&&(this.vr.style.display=t?"table-cell":"none",this.Dr=t)},t.prototype.setAutoScale=function(t){var i=this.F.state();this.F.chart().model().setPriceAutoScale(i,f(this.priceScale()),t)},t.prototype.reset=function(){var t=this.F.state();this.F.chart().model().resetPriceScale(t,f(this.priceScale()))},t.prototype.paint=function(t){this.Dr&&null!==this.Sr&&(this.zr.clearRect(-.5,-.5,this.Sr.w,this.Sr.h),1!==t&&(this.Rr(),this.Ur(this.Ln),this.Lt(this.Ln),this.qr(this.Ln),this.Hr(this.Ln)),this.Yr(this.zr))},t.prototype.getImage=function(){return this.Ar},t.prototype.isLeft=function(){return this.Lr},t.prototype.mr=function(t){if(null!==this.A&&!this.A.isEmpty()&&this.F.chart().options().handleScale.axisPressedMouseMove){var i=this.F.chart().model(),n=this.F.state();this.Cr=!0,i.startScalePrice(n,this.A,t.localY)}},t.prototype.gr=function(t){if(null!==this.A&&this.F.chart().options().handleScale.axisPressedMouseMove){var i=this.F.chart().model(),n=this.F.state(),s=this.A;i.scalePriceTo(n,s,t.localY)}},t.prototype.Vr=function(){if(null!==this.A&&this.F.chart().options().handleScale.axisPressedMouseMove){var t=this.F.chart().model(),i=this.F.state(),n=this.A;this.Cr&&(this.Cr=!1,t.endScalePrice(i,n))}},t.prototype.Mr=function(t){if(null!==this.A&&this.F.chart().options().handleScale.axisPressedMouseMove){var i=this.F.chart().model(),n=this.F.state();this.Cr=!1,i.endScalePrice(n,this.A)}},t.prototype.jr=function(t){this.reset()},t.prototype.Fr=function(t){null!==this.A&&(!this.F.chart().model().options().handleScale.axisPressedMouseMove||this.A.isPercentage()||this.A.isIndexedTo100()||this.Jr(1))},t.prototype.Ir=function(t){this.Jr(0)},t.prototype.Wr=function(){var t=this,i=[],n=null===this.A?void 0:this.A;return function(s){for(var h=0;h<s.length;++h)for(var r=s[h].priceAxisViews(t.F.state(),n),u=0;u<r.length;u++)i.push(r[u])}(this.F.state().orderedSources()),i},t.prototype.Ur=function(t){null!==this.Sr&&an(t,0,0,this.Sr.w,this.Sr.h,this.backgroundColor())},t.prototype.Lt=function(t){if(null!==this.Sr&&null!==this.A&&this.A.options().borderVisible){t.save(),t.fillStyle=this.lineColor();var i,n=this.rendererOptions().borderSize;this.Lr?(t.translate(-.5,-.5),i=this.Sr.w-n-1):(t.translate(.5,-.5),i=0),t.fillRect(i,0,n,this.Sr.h),t.restore()}},t.prototype.qr=function(t){if(null!==this.Sr&&null!==this.A){t.save(),t.strokeStyle=this.lineColor();var i=this.A.marks();t.font=this.baseFont(),t.translate(-.5,-.5),t.fillStyle=this.lineColor();var n=this.rendererOptions(),s=this.A.options().borderVisible,h=this.Lr?this.Sr.w-n.offsetSize-n.borderSize-n.tickLength:n.borderSize+n.offsetSize,r=this.Lr?h-n.paddingInner:h+n.tickLength+n.paddingInner,u=this.Lr?"right":"left";if(s){t.beginPath();for(var e=0,o=i;e<o.length;e++){var f=o[e];t.rect(h,f.coord,n.tickLength,1)}t.fill()}t.fillStyle=this.textColor();for(var a=0,c=i;a<c.length;a++){f=c[a];this.Er.paintTo(t,f.label,r,f.coord,u)}t.restore()}},t.prototype.Rr=function(){if(null!==this.Sr&&null!==this.A){var t=this.Sr.h/2,i=[],n=this.A.orderedSources().slice(),s=this.F.state(),h=this.rendererOptions();this.A===s.defaultPriceScale()&&this.F.state().orderedSources().forEach((function(t){s.isOverlay(t)&&n.push(t)}));var r=this.A.mainSource(),u=this.A;n.forEach((function(n){var h=n.priceAxisViews(s,u);h.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&h.length>0&&(t=h[0].floatCoordinate())}));var e=i.filter((function(i){return i.floatCoordinate()<=t})),o=i.filter((function(i){return i.floatCoordinate()>t}));if(e.sort((function(t,i){return i.floatCoordinate()-t.floatCoordinate()})),e.length&&o.length&&o.push(e[0]),o.sort((function(t,i){return t.floatCoordinate()-i.floatCoordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.A.options().alignLabels){for(var f=1;f<e.length;f++){var a=e[f],c=(v=e[f-1]).height(h,!1);a.coordinate()>(d=v.getFixedCoordinate())-c&&a.setFixedCoordinate(d-c)}for(var l=1;l<o.length;l++){var v,d;a=o[l],c=(v=o[l-1]).height(h,!0);a.coordinate()<(d=v.getFixedCoordinate())+c&&a.setFixedCoordinate(d+c)}}}},t.prototype.Hr=function(t){var i=this;if(null!==this.Sr){var n=this.Sr,s=this.Wr(),h=this.rendererOptions(),r=this.Lr?"right":"left";s.forEach((function(s){if(s.isAxisLabelVisible()){var u=s.renderer();t.save(),u.draw(t,h,i.Or,n.w,r),t.restore()}}))}},t.prototype.Yr=function(t){var i=this;if(null!==this.Sr&&null!==this.A){var n=this.Sr,s=this.F.chart().model(),h=[],r=this.F.state(),u=s.crosshairSource().priceAxisViews(r,this.A);u.length&&h.push(u);var e=this.rendererOptions(),o=this.Lr?"right":"left";h.forEach((function(s){s.forEach((function(s){t.save(),s.renderer().draw(t,e,i.Or,n.w,o),t.restore()}))}))}},t.prototype.Jr=function(t){this.vr.style.cursor=1===t?"ns-resize":"default"},t.prototype.en=function(){var t=this,i=this.optimalWidth();if(this.Tr<i){var n=this.F.chart();null===this.xr&&(this.xr=setTimeout((function(){n&&n.model().fullUpdate(),t.xr=null}),100))}this.Tr=i},t.prototype.Pr=function(t){this.Er.destroy(),this.Er=new xn(t.fontSize,t.color,t.fontFamily)},t}(),En=mn,Tn=function(){function t(i,n){this.Sr=new on(0,0),this.Kr=null,this.$r=null,this.Xr=!1,this._r="none",this.Zr=new G,this.Gr=0,this.Qr=!1,this.tu=null,this.iu=!1,this.nu=null,this.su=i,this.hu=t.PANE_COUNTER++,t.PANE_MAP.set(this.hu,this),this.ru=n,this.ru.onDestroyed().subscribe(this.uu.bind(this),this,!0),this.eu=document.createElement("td"),this.eu.style.padding="0",this.eu.style.position="relative";var s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.ou=document.createElement("td"),this.ou.style.padding="0",this.fu=document.createElement("td"),this.fu.style.padding="0",this.eu.appendChild(s),this.Ar=cn(s,new on(16,16)),this.Ar.style.position="absolute",this.Ar.style.zIndex="1",this.Ar.style.left="0",this.Ar.style.top="0",this.Ln=f(Ci(this.Ar)),this.Br=cn(s,new on(16,16)),this.Br.style.position="absolute",this.Br.style.zIndex="2",this.Br.style.left="0",this.Br.style.top="0",this.zr=f(Ci(this.Br)),this.lr=document.createElement("tr"),this.lr.appendChild(this.ou),this.lr.appendChild(this.eu),this.lr.appendChild(this.fu),this.au(),i.model().mainPriceScaleOptionsChanged().subscribe(this.cu.bind(this),this),this.updatePriceAxisWidget();var h=this.chart().options().handleScroll;this.br=new gn(this.Br,this,{treatVertTouchDragAsPageScroll:!h.vertTouchDrag,treatHorzTouchDragAsPageScroll:!h.horzTouchDrag})}return t.prototype.destroy=function(){null!==this.Kr&&this.Kr.destroy(),null!==this.ru&&this.ru.onDestroyed().unsubscribeAll(this),t.PANE_MAP.delete(this.hu),this.br.destroy()},t.prototype.state=function(){return f(this.ru)},t.prototype.stateOrNull=function(){return this.ru},t.prototype.setState=function(i){null!==this.ru&&this.ru.onDestroyed().unsubscribeAll(this),this.ru=i,null!==this.ru&&this.ru.onDestroyed().subscribe(t.prototype.uu.bind(this),this,!0),this.updatePriceAxisWidget()},t.prototype.chart=function(){return this.su},t.prototype.getElement=function(){return this.lr},t.prototype.updatePriceAxisWidget=function(){if(null!==this.ru&&null!==this.Kr&&0!==this.V().serieses().length){var t=this.ru.defaultPriceScale();this.Kr.setPriceScale(f(t))}},t.prototype.stretchFactor=function(){return null!==this.ru?this.ru.stretchFactor():0},t.prototype.setStretchFactor=function(t){this.ru&&this.ru.setStretchFactor(t)},t.prototype.mouseEnterEvent=function(t){if(this.ru){var i=t.localX,n=t.localY;dn||this.lu(i,n)}},t.prototype.mouseDownEvent=function(t){if(this.Qr=!1,this.iu=null!==this.tu,this.ru){if(document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{var i=document.getSelection();null!==i&&i.removeAllRanges()}var n=this.V();if(!this.ru.defaultPriceScale().isEmpty()&&!n.timeScale().isEmpty()){if(null!==this.tu){var s=n.crosshairSource();this.nu={x:s.appliedX(),y:s.appliedY()},this.tu={x:t.localX,y:t.localY}}dn||this.lu(t.localX,t.localY)}}},t.prototype.mouseMoveEvent=function(t){if(this.ru){var i=t.localX,n=t.localY;if(this.vu()&&this.du(),!dn){this.lu(i,n);var s=this.hitTest(i,n);this.V().setHoveredSource(s&&{source:s.source,object:s.object}),null!==s&&void 0!==s.view.moveHandler&&s.view.moveHandler(i,n),this.wu(i)}}},t.prototype.mouseClickEvent=function(t){if(null!==this.ru){var i=t.localX,n=t.localY,s=this.hitTest(i,n);if(null!==s&&void 0!==s.view.clickHandler&&s.view.clickHandler(i,n),this.Zr.hasListeners()){var h=this.V().crosshairSource().appliedIndex();this.Zr.fire(h,{x:i,y:n})}this.bu()}},t.prototype.pressedMouseMoveEvent=function(t){if(null!==this.ru){var i=this.V(),n=t.localX,s=t.localY;if(null!==this.tu){this.iu=!1;var h=f(this.nu),r=h.x+(n-this.tu.x),u=h.y+(s-this.tu.y);this.lu(r,u)}else this.vu()||this.lu(n,s);if(!i.timeScale().isEmpty()){var e=this.su.options().handleScroll;if(e.pressedMouseMove&&"touch"!==t.type||(e.horzTouchDrag||e.vertTouchDrag)&&"mouse"!==t.type){var o=this.ru.defaultPriceScale();null!==this.$r||this.mu()||(this.$r={x:t.clientX,y:t.clientY}),null===this.$r||this.$r.x===t.clientX&&this.$r.y===t.clientY||this.Xr||(o.isEmpty()||i.startScrollPrice(this.ru,o,t.localY),i.startScrollTime(t.localX),this.Xr=!0),this.Xr&&(o.isEmpty()||i.scrollPriceTo(this.ru,o,t.localY),i.scrollTimeTo(t.localX))}}}},t.prototype.mouseUpEvent=function(t){if(null!==this.ru){this.Qr=!1;var i=this.V();if(this.Xr){var n=this.ru.defaultPriceScale();i.endScrollPrice(this.ru,n),i.endScrollTime(),this.$r=null,this.Xr=!1}}},t.prototype.longTapEvent=function(t){if(this.Qr=!0,null===this.tu&&En){var i={x:t.localX,y:t.localY};this.gu(i,i)}},t.prototype.mouseLeaveEvent=function(t){null!==this.ru&&(this.ru.model().setHoveredSource(null),mn||(this.du(),this.wu()))},t.prototype.clicked=function(){return this.Zr},t.prototype.pinchStartEvent=function(){this.Gr=1},t.prototype.pinchEvent=function(t,i){if(this.su.options().handleScale.pinch){var n=5*(i-this.Gr);this.Gr=i,this.V().zoomTime(t.x,n)}},t.prototype.hitTest=function(t,i){var n=this.ru;if(null===n)return null;for(var s=0,h=n.orderedSources();s<h.length;s++){var r=h[s],u=this.Mu(r.paneViews(n),t,i);if(null!==u)return{source:r,view:u.view,object:u.object}}return null},t.prototype.setPriceAxisSize=function(t){f(this.Kr).setSize(new on(t,this.Sr.h))},t.prototype.getSize=function(){return this.Sr},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Sr.equals(t)||(this.Sr=t,fn(this.Ar,t),fn(this.Br,t),this.Ln=f(Ci(this.Ar)),this.eu.style.width=t.w+"px",this.eu.style.height=t.h+"px")},t.prototype.recalculatePriceScale=function(){var t=f(this.ru);t.recalculatePriceScale(t.defaultPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var s=n[i];if(t.isOverlay(s)){var h=s.priceScale();null!==h&&t.recalculatePriceScale(h),s.updateAllViews()}}},t.prototype.getImage=function(){return this.Ar},t.prototype.paint=function(t){0!==t&&null!==this.ru&&(t>1&&this.recalculatePriceScale(),null!==this.Kr&&this.Kr.paint(t),this.zr.clearRect(-.5,-.5,this.Sr.w,this.Sr.h),1!==t&&(this.Ur(this.Ln,this.pu()),this.ru&&(this.yu(this.Ln),this.ku(this.Ln),this.Nu(this.Ln))),this.Su(this.zr))},t.prototype.priceAxisWidget=function(){return this.Kr},t.prototype.setCrosshairPositionByTime=function(t){var i=this.V().timeScale().timeToCoordinate(1e3*t);this.lu(i,0)},t.prototype.wu=function(i){var n=this;if(void 0!==i){var s=this.V().timeScale().coordinateToIndex(i),h=this.V().timeScale().indexToUserTime(s);h&&t.PANE_MAP.forEach((function(t,i){n.hu!==i&&t.setCrosshairPositionByTime(h.timestamp)}))}else t.PANE_MAP.forEach((function(t,i){n.hu!==i&&t.du()}))},t.prototype.pu=function(){return this.su.options().layout.backgroundColor},t.prototype.uu=function(){null!==this.ru&&this.ru.onDestroyed().unsubscribeAll(this),this.ru=null},t.prototype.Ur=function(t,i){an(t,0,0,this.Sr.w,this.Sr.h,i)},t.prototype.yu=function(t){for(var i=f(this.ru),n=this.V().gridSource().paneViews(i),s=i.height(),h=i.width(),r=0,u=n;r<u.length;r++){var e=u[r];t.save();var o=e.renderer(s,h);null!==o&&o.draw(t,!1),t.restore()}},t.prototype.ku=function(t){var i=this.V().watermarkSource();if(null!==i){var n=f(this.ru);if(n.containsSeries())for(var s=i.paneViews(),h=n.height(),r=n.width(),u=0,e=s;u<e.length;u++){var o=e[u];t.save();var a=o.renderer(h,r);null!==a&&a.draw(t,!1),t.restore()}}},t.prototype.Su=function(t){this.xu(this.V().crosshairSource(),t)},t.prototype.Nu=function(t){for(var i=f(this.ru).orderedSources(),n=this.V().crosshairSource(),s=0,h=i;s<h.length;s++){var r=h[s];this.Cu(r,t)}for(var u=0,e=i;u<e.length;u++){(r=e[u])!==n&&this.xu(r,t)}},t.prototype.xu=function(t,i){for(var n=f(this.ru),s=t.paneViews(n),h=n.height(),r=n.width(),u=n.model().hoveredSource(),e=null!==u&&u.source===t,o=null!==u&&e&&void 0!==u.object?u.object.hitTestData:void 0,a=0,c=s;a<c.length;a++){var l=c[a].renderer(h,r);null!==l&&(i.save(),l.draw(i,e,o),i.restore())}},t.prototype.Cu=function(t,i){for(var n=f(this.ru),s=t.paneViews(n),h=n.height(),r=n.width(),u=n.model().hoveredSource(),e=null!==u&&u.source===t,o=null!==u&&e&&void 0!==u.object?u.object.hitTestData:void 0,a=0,c=s;a<c.length;a++){var l=c[a].renderer(h,r);null!==l&&void 0!==l.drawBackground&&(i.save(),l.drawBackground(i,e,o),i.restore())}},t.prototype.Mu=function(t,i,n){for(var s=0,h=t;s<h.length;s++){var r=h[s],u=r.renderer(this.Sr.h,this.Sr.w);if(null!==u&&u.hitTest){var e=u.hitTest(i,n);if(null!==e)return{view:r,object:e}}}return null},t.prototype.cu=function(){this.au(),this.su.adjustSize()},t.prototype.au=function(){if(null!==this.ru){var t=this.su,i=this.ru.defaultPriceScale().options().position;if(this._r!==i){if(null!==this.Kr&&(this.Kr.isLeft()?this.ou.removeChild(this.Kr.getElement()):this.fu.removeChild(this.Kr.getElement()),this.Kr.destroy(),this.Kr=null),"none"!==i){var n=t.model().rendererOptionsProvider();this.Kr=new On(this,t.options().layout,n,i),"left"===i&&this.ou.appendChild(this.Kr.getElement()),"right"===i&&this.fu.appendChild(this.Kr.getElement())}this._r=i}}},t.prototype.vu=function(){return En&&null===this.tu},t.prototype.mu=function(){return En&&this.Qr||null!==this.tu},t.prototype.Du=function(t){return Math.max(0,Math.min(t,this.Sr.w-1))},t.prototype.Ou=function(t){return Math.max(0,Math.min(t,this.Sr.h-1))},t.prototype.lu=function(t,i){this.V().setAndSaveCurrentPosition(this.Du(t),this.Ou(i),f(this.ru))},t.prototype.du=function(){this.V().clearCurrentPosition()},t.prototype.bu=function(){this.iu&&(this.tu=null,this.du())},t.prototype.gu=function(t,i){this.tu=t,this.iu=!1,this.lu(i.x,i.y);var n=this.V().crosshairSource();this.nu={x:n.appliedX(),y:n.appliedY()}},t.prototype.V=function(){return this.su.model()},t.PANE_COUNTER=0,t.PANE_MAP=new Map,t}(),Ln=function(){function t(t,i,n,s){this.o=!0,this.Sr=new on(0,0),this.Lr="left"===t,this.vh=n.rendererOptionsProvider,this.K=i,this.Eu=s,this.vr=document.createElement("div"),this.vr.style.width="25px",this.vr.style.height="100%",this.vr.style.overflow="hidden",this.Ar=cn(this.vr,new on(16,16)),this.Ln=Ci(this.Ar)}return t.prototype.destroy=function(){},t.prototype.update=function(){this.o=!0},t.prototype.getElement=function(){return this.vr},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Sr.equals(t)||(this.Sr=t,fn(this.Ar,t),this.vr.style.width=t.w+"px",this.vr.style.minWidth=t.w+"px",this.vr.style.height=t.h+"px",this.o=!0)},t.prototype.paint=function(t){t<3&&!this.o||0!==this.Sr.w&&0!==this.Sr.h&&(this.o=!1,this.Ur(),this.Lt())},t.prototype.getImage=function(){return this.Ar},t.prototype.getWidth=function(){return this.Sr.w},t.prototype.isLeft=function(){return this.Lr},t.prototype.Lt=function(){if(this.Eu()){var t=this.Sr.w;this.Ln.save(),this.Ln.fillStyle=this.K.timeScale.borderColor;var i,n=this.vh.options().borderSize;this.Lr?(this.Ln.translate(-.5,-.5),i=t-n-1):(this.Ln.translate(-.5,-.5),i=0),this.Ln.fillRect(i,0,2*n,1),this.Ln.restore()}},t.prototype.Ur=function(){an(this.Ln,0,0,this.Sr.w,this.Sr.h,this.K.layout.backgroundColor)},t}();function An(t,i){return t.span>i.span?t:i}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=3]="TickLength"}(Cn||(Cn={})),function(t){t[t.Default=0]="Default",t[t.EwResize=1]="EwResize"}(Dn||(Dn={}));var Bn,zn=function(){function t(t){this.Tu=null,this.Lu=70,this.Ht=null,this.Au=!1,this.Sr=new on(0,0),this._r="none",this.su=t,this.K=t.options().layout,this.Bu=document.createElement("tr"),this.zu=document.createElement("td"),this.zu.style.padding="0",this.Vu=document.createElement("td"),this.Vu.style.padding="0",this.vr=document.createElement("td"),this.vr.style.height="25px",this.vr.style.padding="0",this.ju=document.createElement("div"),this.ju.style.width="100%",this.ju.style.height="100%",this.ju.style.position="relative",this.ju.style.overflow="hidden",this.vr.appendChild(this.ju),this.Ar=cn(this.ju,new on(16,16)),this.Ar.style.position="absolute",this.Ar.style.zIndex="1",this.Ar.style.left="0",this.Ar.style.top="0",this.Fu=f(Ci(this.Ar)),this.Br=cn(this.ju,new on(16,16)),this.Br.style.position="absolute",this.Br.style.zIndex="2",this.Br.style.left="0",this.Br.style.top="0",this.Iu=f(Ci(this.Br)),this.Bu.appendChild(this.zu),this.Bu.appendChild(this.vr),this.Bu.appendChild(this.Vu),this.Pu(),this.su.model().mainPriceScaleOptionsChanged().subscribe(this.Pu.bind(this),this),this.br=new gn(this.Br,this,{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1})}return t.prototype.destroy=function(){this.br.destroy(),null!==this.Tu&&this.Tu.destroy()},t.prototype.getElement=function(){return this.Bu},t.prototype.stub=function(){return this.Tu},t.prototype.mouseDownEvent=function(t){if(!this.Au){this.Au=!0;var i=this.su.model();!i.timeScale().isEmpty()&&this.su.options().handleScale.axisPressedMouseMove&&i.startScaleTime(t.localX)}},t.prototype.mouseDownOutsideEvent=function(){var t=this.su.model();!t.timeScale().isEmpty()&&this.Au&&(this.Au=!1,this.su.options().handleScale.axisPressedMouseMove&&t.endScaleTime())},t.prototype.pressedMouseMoveEvent=function(t){var i=this.su.model();!i.timeScale().isEmpty()&&this.su.options().handleScale.axisPressedMouseMove&&i.scaleTimeTo(t.localX)},t.prototype.mouseUpEvent=function(t){this.Au=!1;var i=this.su.model();i.timeScale().isEmpty()&&!this.su.options().handleScale.axisPressedMouseMove||i.endScaleTime()},t.prototype.mouseDoubleClickEvent=function(){this.su.model().resetTimeScale()},t.prototype.mouseEnterEvent=function(t){this.su.model().options().handleScale.axisPressedMouseMove&&this.Jr(1)},t.prototype.mouseLeaveEvent=function(t){this.Jr(0)},t.prototype.setSizes=function(t,i){this.Sr&&this.Sr.equals(t)||(this.Sr=t,fn(this.Ar,t),fn(this.Br,t),Ci(this.Ar),Ci(this.Br),this.vr.style.width=t.w+"px",this.vr.style.height=t.h+"px"),null!==this.Tu&&this.Tu.setSize(new on(i,t.h))},t.prototype.width=function(){return this.Sr.w},t.prototype.height=function(){return this.Sr.h},t.prototype.optimalHeight=function(){var t=this.Wu();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.update=function(){var t=this,i=this.su.model().timeScale().marks();i&&(this.Lu=70,i.forEach((function(i){t.Lu=Math.min(i.span,t.Lu)})))},t.prototype.getImage=function(){return this.Ar},t.prototype.paint=function(t){if(0!==t){if(1!==t){var i=this.Fu;this.Ur(i),this.Lt(i),this.qr(i),this.Hr(i),null!==this.Tu&&this.Tu.paint(t)}this.Yr(this.Iu)}},t.prototype.Ur=function(t){an(t,0,0,this.Sr.w,this.Sr.h,this.pu())},t.prototype.Lt=function(t){this.su.options().timeScale.borderVisible&&(t.save(),t.fillStyle=this.Ru(),t.translate(-.5,-.5),t.fillRect(0,0,this.Sr.w,1),t.restore())},t.prototype.qr=function(t){var i=this.su.model().timeScale().marks();if(i&&0!==i.length){var n=i.reduce(An,i[0]).span;n>30&&n<40&&(n=30),t.save(),t.strokeStyle=this.Ru();var s=this.Wu(),h=s.borderSize+s.tickLength+s.paddingTop+s.fontSize-s.baselineOffset;if(t.textAlign="center",t.translate(.5,-.5),t.fillStyle=this.Ru(),this.su.model().timeScale().options().borderVisible){t.beginPath();for(var r=i.length;r--;)t.rect(i[r].coord,1,1,s.tickLength);t.fill()}t.fillStyle=this.Fn(),t.font=this.Uu();for(var u=0,e=i;u<e.length;u++){(a=e[u]).span<n&&t.fillText(a.label,a.coord,h)}t.font=this.qu();for(var o=0,f=i;o<f.length;o++){var a;(a=f[o]).span>=n&&t.fillText(a.label,a.coord,h)}t.restore()}},t.prototype.Hr=function(t){t.save();var i=new Set,n=this.su.model(),s=n.dataSources();i.add(n.crosshairSource());for(var h=this.Wu(),r=0,u=s;r<u.length;r++){var e=u[r];if(!i.has(e))for(var o=0,f=e.timeAxisViews();o<f.length;o++){f[o].renderer().draw(t,h)}}t.restore()},t.prototype.Yr=function(t){this.Iu.clearRect(-.5,-.5,this.Sr.w,this.Sr.h);var i=[],n=this.su.model().crosshairSource().timeAxisViews();i.push(n);var s=this.Wu();i.forEach((function(i){i.forEach((function(i){t.save(),i.renderer().draw(t,s),t.restore()}))}))},t.prototype.pu=function(){return this.K.backgroundColor},t.prototype.Ru=function(){return this.su.options().timeScale.borderColor},t.prototype.Fn=function(){return this.K.textColor},t.prototype._t=function(){return this.K.fontSize},t.prototype.Uu=function(){return Ei(this._t(),this.K.fontFamily)},t.prototype.qu=function(){return Ei(this._t(),this.K.fontFamily,"bold")},t.prototype.Wu=function(){null===this.Ht&&(this.Ht={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new Ft});var t=this.Ht,i=this.Uu();if(t.font!==i){var n=this._t();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this._t()/5),t.widthCache.reset()}return this.Ht},t.prototype.Jr=function(t){this.vr.style.cursor=1===t?"ew-resize":"default"},t.prototype.Pu=function(){var t=this.su.model().mainPriceScale().options().position;if(t!==this._r){if(null!==this.Tu&&(this.Tu.isLeft()?this.zu.removeChild(this.Tu.getElement()):this.Vu.removeChild(this.Tu.getElement()),this.Tu.destroy(),this.Tu=null),"none"!==t){var i={rendererOptionsProvider:this.su.model().rendererOptionsProvider()},n=this.su.model();this.Tu=new Ln(t,this.su.options(),i,(function(){return n.mainPriceScale().options().borderVisible&&n.timeScale().options().borderVisible})),("left"===t?this.zu:this.Vu).appendChild(this.Tu.getElement())}this._r=t}},t}(),Vn=function(){function t(t,i){var n=this;this.Hu=[],this.Yu=[],this.Ju=0,this.Ku=new G,this.Gi=0,this.Jt=0,this.$u=0,this.Xu=null,this._u=!1,this.Zr=new G,this.ah=new G,this.K=i,this.Bu=document.createElement("div"),this.Bu.classList.add("tv-lightweight-charts"),this.Bu.style.overflow="hidden",this.Bu.style.width="100%",this.Bu.style.height="100%",this.Zu=document.createElement("table"),this.Zu.setAttribute("cellspacing","0"),this.Bu.appendChild(this.Zu),this.Gu=this.Qu.bind(this),this.Bu.addEventListener("wheel",this.Gu,{passive:!1}),this.V=new en(this.lh.bind(this),this.K),this.model().crosshairMoved().subscribe(this.te.bind(this),this),this.ie=new zn(this),this.Zu.appendChild(this.ie.getElement());var s=this.K.width,h=this.K.height;if(0===s&&0===h){var r=t.getBoundingClientRect();s=r.width,h=r.height}s=Math.max(70,s),h=Math.max(50,h),this.resize(h,s),this.ne(),t.appendChild(this.Bu),this.se(),this.V.timeScale().optionsApplied().subscribe((function(){n.se(),n.adjustSize()}),this)}return t.prototype.model=function(){return this.V},t.prototype.options=function(){return this.K},t.prototype.paneWidgets=function(){return this.Hu},t.prototype.destroy=function(){this.Bu.removeEventListener("wheel",this.Gu),0!==this.Ju&&window.cancelAnimationFrame(this.Ju),this.V.crosshairMoved().unsubscribeAll(this),this.V.timeScale().optionsApplied().unsubscribeAll(this),this.V.destroy();for(var t=0,i=this.Hu;t<i.length;t++){var n=i[t];this.Zu.removeChild(n.getElement()),n.clicked().unsubscribeAll(this),n.destroy()}this.Hu=[];for(var s=0,h=this.Yu;s<h.length;s++){var r=h[s];this.he(r)}this.Yu=[],f(this.ie).destroy(),null!==this.Bu.parentElement&&this.Bu.parentElement.removeChild(this.Bu),this.ah.destroy(),this.Zr.destroy(),delete this.Bu},t.prototype.resize=function(t,i,n){if(void 0===n&&(n=!1),this.Gi!==t||this.Jt!==i){this.Gi=t,this.Jt=i;var s=t+"px",h=i+"px";f(this.Bu).style.height=s,f(this.Bu).style.width=h,this.Zu.style.height=s,this.Zu.style.width=h,n?this.ue(new Vi(3)):this.V.fullUpdate()}},t.prototype.paint=function(t){void 0===t&&(t=new Vi(3));for(var i=0;i<this.Hu.length;i++)this.Hu[i].paint(t.invalidateForPane(i).level);this.ie.paint(t.fullInvalidation())},t.prototype.adjustSize=function(){this.ee(),this.V.fullUpdate()},t.prototype.applyOptions=function(t){this.V.applyOptions(t),this.se();var i=t.width||this.Jt,n=t.height||this.Gi;this.resize(n,i)},t.prototype.clicked=function(){return this.Zr},t.prototype.crosshairMoved=function(){return this.ah},t.prototype.takeScreenshot=function(){var t=this;null!==this.Xu&&(this.ue(this.Xu),this.Xu=null);var i=this.Hu[0],n=this.Jt,s=this.Gi,h=document.createElement("canvas");fn(h,new on(n,s));var r=f(Ci(h));r.translate(-.5,-.5);var u=0,e=0,o=function(){for(var i=0;i<t.Hu.length;i++){var n=t.Hu[i],s=f(n.priceAxisWidget()).getImage();r.drawImage(s,u,e),e+=n.getSize().h,i<t.Hu.length-1&&(e+=1)}};"left"===this.K.priceScale.position&&(o(),u=f(i.priceAxisWidget()).getWidth()),e=0;for(var a=0;a<this.Hu.length;a++){var c=this.Hu[a],l=c.getImage();if(r.drawImage(l,u,e),e+=c.getSize().h,a<this.Hu.length-1){var v=this.Yu[a].getImage();r.drawImage(v,u,e),e+=1}}u+=i.getSize().w,"right"===this.K.priceScale.position&&(e=0,o());var d=function(){var i=f(t.ie.stub()).getImage();r.drawImage(i,u,e)};if(this.K.timeScale.visible){u=0,"left"===this.K.priceScale.position&&(d(),u=f(i.priceAxisWidget()).getWidth());l=this.ie.getImage();r.drawImage(l,u,e),"right"===this.K.priceScale.position&&(u=i.getSize().w,d(),r.restore())}return h},t.prototype.ee=function(){for(var t=0,i=0,n=0,s=this.Hu;n<s.length;n++){var h=s[n];"none"!==this.K.priceScale.position&&(i=Math.max(i,f(h.priceAxisWidget()).optimalWidth())),t+=h.stretchFactor()}for(var r=this.Jt,u=this.Gi,e=Math.max(r-i,0),o=1*this.Yu.length,a=this.K.timeScale.visible?this.ie.optimalHeight():0,c=o+a,l=u<c?0:u-c,v=l/t,d=0,w=0;w<this.Hu.length;++w){(h=this.Hu[w]).setState(this.V.panes()[w]);var b,m=0;m=w===this.Hu.length-1?l-d:Math.round(h.stretchFactor()*v),d+=b=Math.max(m,2),h.setSize(new on(e,b)),"none"!==this.K.priceScale.position&&h.setPriceAxisSize(i),h.state()&&this.V.setPaneHeight(h.state(),b)}this.ie.setSizes(new on(e,a),i),this.V.setWidth(e),this.$u!==i&&(this.$u=i,this.Ku.fire(i))},t.prototype.Qu=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.K.handleScroll.mouseWheel||0!==n&&this.K.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.K.handleScale.mouseWheel){var s=Math.sign(n)*Math.min(1,Math.abs(n)),h=t.clientX-this.Bu.getBoundingClientRect().left;this.model().zoomTime(h,s)}0!==i&&this.K.handleScroll.mouseWheel&&this.model().scrollChart(-80*i)}},t.prototype.ue=function(t){var i=t.fullInvalidation();if(3===i&&this.oe(),3===i||2===i){for(var n=this.V.panes(),s=0;s<n.length;s++)t.invalidateForPane(s).autoScale&&n[s].momentaryAutoScale();t.getFitContent()&&this.V.timeScale().fitContent();var h=t.getTargetTimeRange();null!==h&&this.V.timeScale().setTimePointsRange(h),this.ie.update()}this.paint(t)},t.prototype.lh=function(t){var i=this;null!==this.Xu?this.Xu.merge(t):this.Xu=t,this._u||(this._u=!0,this.Ju=window.requestAnimationFrame((function(){i._u=!1,i.Ju=0,null!==i.Xu&&(i.ue(i.Xu),i.Xu=null)})))},t.prototype.oe=function(){this.ne()},t.prototype.he=function(t){this.Zu.removeChild(t.getElement()),t.destroy()},t.prototype.ne=function(){for(var t=this.V.panes(),i=t.length,n=this.Hu.length,s=i;s<n;s++){var h=o(this.Hu.pop());this.Zu.removeChild(h.getElement()),h.clicked().unsubscribeAll(this),h.destroy(),void 0!==(r=this.Yu.pop())&&this.he(r)}for(s=n;s<i;s++){if((h=new Tn(this,t[s])).clicked().subscribe(this.fe.bind(this),this),this.Hu.push(h),s>1){var r=new Sn(this,s-1,s,!0);this.Yu.push(r),this.Zu.insertBefore(r.getElement(),this.ie.getElement())}this.Zu.insertBefore(h.getElement(),this.ie.getElement())}for(s=0;s<i;s++){var u=t[s];(h=this.Hu[s]).state()!==u?h.setState(u):h.updatePriceAxisWidget()}this.se(),this.ee()},t.prototype.ae=function(t,i){var n,s=new Map;null!==t&&this.V.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&s.set(i,n)}));if(null!==t){var h=this.V.timeScale().indexToUserTime(t);null!==h&&(n=h)}var r=this.model().hoveredSource(),u=null!==r&&r instanceof wi?r:void 0,e=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{time:n,point:i||void 0,hoveredSeries:u,seriesPrices:s,hoveredObject:e}},t.prototype.fe=function(t,i){var n=this;this.Zr.fire((function(){return n.ae(t,i)}))},t.prototype.te=function(t,i){var n=this;this.ah.fire((function(){return n.ae(t,i)}))},t.prototype.se=function(){var t=this.K.timeScale.visible?"":"none";this.ie.getElement().style.display=t},t}();function jn(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function Fn(t){if(!pi(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function In(t){if(!yi(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function Pn(t){return 0===t.length?null:pi(t[0].time)?Fn:In}function Wn(t){return yi(t)?In(t):pi(t)?Fn(t):Fn(Zn(t))}function Rn(t,i){var n=t.value,s=null;return"color"in t&&void 0!==t.color&&(s=i.addColor(t.color)),{value:[n,n,n,n,s],glyphs:[]}}function Un(t,i){return{value:[t.open,t.high,t.low,t.close,null],glyphs:t.glyphs&&t.glyphs.length?JSON.parse(JSON.stringify(t.glyphs)):[]}}!function(t){t[t.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",t[t.LastValueAccordingToScale=1]="LastValueAccordingToScale"}(Bn||(Bn={}));var qn={Candlestick:Un,Bar:Un,Area:Rn,Histogram:Rn,Line:Rn};function Hn(t){return qn[t]}function Yn(t){return 60*t*60*1e3}function Jn(t){return 60*t*1e3}var Kn,$n=[{divisor:1,span:20},{divisor:(Kn=1,1e3*Kn),span:19},{divisor:Jn(1),span:20},{divisor:Jn(5),span:21},{divisor:Jn(30),span:22},{divisor:Yn(1),span:30},{divisor:Yn(3),span:31},{divisor:Yn(6),span:32},{divisor:Yn(12),span:33}];function Xn(t,i){if(null!==i){var n=new Date(1e3*i.timestamp),s=new Date(1e3*t.timestamp);if(s.getUTCFullYear()!==n.getUTCFullYear())return 70;if(s.getUTCMonth()!==n.getUTCMonth())return 60;if(s.getUTCDate()!==n.getUTCDate())return 50;for(var h=$n.length-1;h>=0;--h)if(Math.floor(n.getTime()/$n[h].divisor)!==Math.floor(s.getTime()/$n[h].divisor))return $n[h].span}return 20}function _n(t,i){return t.timestamp<i.timestamp}function Zn(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function Gn(t){d(t.time)&&(t.time=Zn(t.time))}var Qn,ts=function(){function t(){this.ce=new Map,this.le=new Map,this.ve=[]}return t.prototype.destroy=function(){this.ce.clear(),this.le.clear(),this.ve=[]},t.prototype.setSeriesData=function(t,i){var n=this;t.palette().clear(),function(t){t.forEach(Gn)}(i),this.ce.forEach((function(i){return i.mapping.delete(t)}));var s=Pn(i);null!==s&&i.forEach((function(i){var h=s(i.time),r=n.ce.get(h.timestamp)||{index:0,mapping:new Map,timePoint:h};r.mapping.set(t,i),n.ce.set(h.timestamp,r)}));var h=new Map;return this.ce.forEach((function(t,i){t.mapping.size>0&&h.set(i,t)})),this.de(h)},t.prototype.removeSeries=function(t){return this.setSeriesData(t,[])},t.prototype.updateSeriesData=function(t,i){Gn(i);var n=t.data().bars();if(n.size()>0)if(void 0!==f(n.last()).time.businessDay){if(!pi(i.time))throw new Error("time must be of type BusinessDay")}else if(!yi(i.time))throw new Error("time must be of type isUTCTimestamp");var s=f(Pn([i]))(i.time),h=this.ce.get(s.timestamp)||{index:0,mapping:new Map,timePoint:s},r=0===h.mapping.size;h.mapping.set(t,i);var u=!1;if(r){var e=this.ce.size;this.ve.length>0&&this.ve[this.ve.length-1].timestamp>s.timestamp?(e=gt(this.ve,s,_n),this.ve.splice(e,0,s),this.we(e),u=!0):this.ve.push(s),h.index=e,this.le.set(h.index,s)}this.ce.set(s.timestamp,h);var a=new Map,c=function(i){var n=o(l.le.get(i));o(l.ce.get(n.timestamp)).mapping.forEach((function(s,h){if(u||h===t){var r=Hn(h.seriesType()),e=a.get(h)||{update:[]},o={index:i,time:n,plot:r(s,h.palette())};e.update.push(o),a.set(h,e)}}))},l=this;for(e=h.index;e<this.ce.size;++e)c(e);var v=r?this.be(h.index):[],d=r?this.ve.slice(h.index):[];return{timeScaleUpdate:{seriesUpdates:a,changes:d,index:h.index,marks:v}}},t.prototype.de=function(t){var i=this;this.ce=t,this.ve=Array.from(this.ce.values()).map((function(t){return t.timePoint})),this.ve.sort((function(t,i){return t.timestamp-i.timestamp}));var n=new Map;this.ve.forEach((function(t,s){var h=o(i.ce.get(t.timestamp));h.index=s,h.mapping.forEach((function(i,h){var r=Hn(h.seriesType()),u=n.get(h)||{update:[]},e={index:s,time:t,plot:r(i,h.palette())};u.update.push(e),n.set(h,u)}))}));var s=null,h=this.ve.map((function(t,i){var n=Xn(t,s);return s=t,{span:n,time:t,index:i}})),r={seriesUpdates:n,changes:this.ve.slice(),index:0,marks:h};return this.me(),{timeScaleUpdate:r}},t.prototype.we=function(t){for(var i=this.le.size-1;i>=t;--i){var n=o(this.le.get(i)),s=i+1;o(this.ce.get(n.timestamp)).index=s,this.le.delete(i),this.le.set(s,n)}},t.prototype.me=function(){var t=this;this.le.clear(),this.ce.forEach((function(i,n){t.le.set(i.index,i.timePoint)}))},t.prototype.be=function(t){for(var i=[],n=this.le.get(t-1)||null,s=t;s<this.le.size;++s){var h=o(this.le.get(s)),r=Xn(h,n);n=h,i.push({span:r,time:h,index:s})}return i},t}(),is=function(){function t(t,i){this._series=t,this._dataUpdatesConsumer=i}return t.prototype.destroy=function(){delete this._series,delete this._dataUpdatesConsumer},t.prototype.priceFormatter=function(){return this._series.formatter()},t.prototype.series=function(){return this._series},t.prototype.priceToCoordinate=function(t){var i=this._series.firstValue();return null===i?null:this._series.priceScale().priceToCoordinate(t,i.value)},t.prototype.setData=function(t){this._dataUpdatesConsumer.applyNewData(this._series,t)},t.prototype.update=function(t){this._dataUpdatesConsumer.updateData(this._series,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return u({},t,{time:Wn(t.time)})}));this._series.setMarkers(i)},t.prototype.applyOptions=function(t){this._series.applyOptions(t)},t.prototype.options=function(){return b(this._series.options())},t}(),ns=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype.applyOptions=function(i){jn(i),t.prototype.applyOptions.call(this,i)},i}(is),ss={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},hs={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},rs={color:"#2196f3",lineStyle:0,lineWidth:3,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},us={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},es={color:"#26a69a",base:0,lineWidth:2},os={title:"",lastValueVisible:!0,priceLineVisible:!0,priceLineWidth:1,priceLineColor:"",priceLineStyle:1,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01},scaleGroup:""},fs=function(){function t(t){this.l=t}return t.prototype.destroy=function(){delete this.l},t.prototype.applyOptions=function(t){this.l.applyOptions({priceScale:t})},t.prototype.options=function(){return this.A().options()},t.prototype.A=function(){return this.l.mainPriceScale()},t}();!function(t){t[t.AnimationDurationMs=1e3]="AnimationDurationMs"}(Qn||(Qn={}));var as=function(){function t(t){this.V=t}return t.prototype.destroy=function(){delete this.V},t.prototype.scrollPosition=function(){return this.Xn().rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.Xn().scrollToOffsetAnimated(t,1e3):this.Xn().setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.Xn().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t=this.Xn().visibleBars();if(null===t)return null;var i=this.V.timeScale().points(),n=f(i.firstIndex()),s=f(i.lastIndex());return{from:cs(f(i.valueAt(Math.max(n,t.firstBar())))),to:cs(f(i.valueAt(Math.min(s,t.lastBar()))))}},t.prototype.setVisibleRange=function(t){var i={from:Wn(t.from),to:Wn(t.to)};this.V.setTargetTimeRange(i)},t.prototype.resetTimeScale=function(){this.V.resetTimeScale()},t.prototype.fitContent=function(){this.V.fitContent()},t.prototype.applyOptions=function(t){this.Xn().applyOptions(t)},t.prototype.options=function(){return b(this.Xn().options())},t.prototype.Xn=function(){return this.V.timeScale()},t}();function cs(t){return t.businessDay||t.timestamp}function ls(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}var vs=function(){function t(t,i){var n=this;this.ge=new ts,this.Me=new G,this.pe=new Map,this.ye=new Map,this.ke=new G,this.Ne=new G,this.or=new Vn(t,i),this.or.model().timeScale().visibleBarsChanged().subscribe(this.Se.bind(this)),this.or.clicked().subscribe((function(t){n.ke.hasListeners()&&n.ke.fire(n.xe(t()))}),this),this.or.crosshairMoved().subscribe((function(t){n.Ne.hasListeners()&&n.Ne.fire(n.xe(t()))}),this);var s=this.or.model();this.Ce=new fs(s),this.De=new as(s)}return t.prototype.remove=function(){this.or.model().timeScale().visibleBarsChanged().unsubscribeAll(this),this.or.clicked().unsubscribeAll(this),this.or.crosshairMoved().unsubscribeAll(this),this.Ce.destroy(),this.De.destroy(),this.or.destroy(),delete this.or,this.pe.forEach((function(t,i){i.destroy()})),this.pe.clear(),this.ye.clear(),this.Me.destroy(),this.ke.destroy(),this.Ne.destroy(),this.ge.destroy(),delete this.ge},t.prototype.resize=function(t,i,n){this.or.resize(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),ls(t.priceFormat);var i=c(b(os),us,t),n=this.or.model().createSeries("Area",i),s=new is(n,this);return this.pe.set(s,n),this.ye.set(n,s),s},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),ls(t.priceFormat);var i=c(b(os),hs,t),n=this.or.model().createSeries("Bar",i),s=new is(n,this);return this.pe.set(s,n),this.ye.set(n,s),s},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),jn(t),ls(t.priceFormat);var i=c(b(os),ss,t),n=this.or.model().createSeries("Candlestick",i),s=new ns(n,this);return this.pe.set(s,n),this.ye.set(n,s),s},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),ls(t.priceFormat);var i=c(b(os),es,t),n=this.or.model().createSeries("Histogram",i),s=new is(n,this);return this.pe.set(s,n),this.ye.set(n,s),s},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),ls(t.priceFormat);var i=c(b(os),rs,t),n=this.or.model().createSeries("Line",i),s=new is(n,this);return this.pe.set(s,n),this.ye.set(n,s),s},t.prototype.removeSeries=function(t){var i=t,n=o(this.pe.get(i)),s=this.ge.removeSeries(n),h=this.or.model();h.removeSeries(n);var r=s.timeScaleUpdate;h.updateTimeScale(r.index,r.changes,r.marks,!0),r.seriesUpdates.forEach((function(t,i){i.setData(t.update)})),h.updateTimeScaleBaseIndex(0),this.pe.delete(i),this.ye.delete(n)},t.prototype.applyNewData=function(t,i){var n=this.ge.setSeriesData(t,i),s=this.or.model(),h=n.timeScaleUpdate;s.updateTimeScale(h.index,h.changes,h.marks,!0),h.seriesUpdates.forEach((function(t,i){i.setData(t.update)})),s.updateTimeScaleBaseIndex(0)},t.prototype.updateData=function(t,i){var n=this.ge.updateSeriesData(t,i),s=this.or.model(),h=n.timeScaleUpdate;s.updateTimeScale(h.index,h.changes,h.marks,!1),h.seriesUpdates.forEach((function(t,i){i.updateData(t.update)})),s.updateTimeScaleBaseIndex(0)},t.prototype.subscribeClick=function(t){this.ke.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.ke.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this.Ne.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.Ne.unsubscribe(t)},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.Me.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.Me.unsubscribe(t)},t.prototype.priceScale=function(){return this.Ce},t.prototype.timeScale=function(){return this.De},t.prototype.applyOptions=function(t){this.or.applyOptions(t)},t.prototype.options=function(){return this.or.options()},t.prototype.takeScreenshot=function(){return this.or.takeScreenshot()},t.prototype.Se=function(){this.Me.hasListeners()&&this.Me.fire(this.timeScale().getVisibleRange())},t.prototype.Oe=function(t){return o(this.ye.get(t))},t.prototype.xe=function(t){var i=this,n=new Map;t.seriesPrices.forEach((function(t,s){n.set(i.Oe(s),t)}));var s=void 0===t.hoveredSeries?void 0:this.Oe(t.hoveredSeries);return{time:t.time&&(t.time.businessDay||t.time.timestamp),point:t.point,hoveredSeries:s,hoveredMarkerId:t.hoveredObject,seriesPrices:n}},t}(),ds={width:0,height:0,layout:{backgroundColor:"#FFFFFF",textColor:"#191919",fontSize:11,fontFamily:"'Trebuchet MS', Roboto, Ubuntu, sans-serif"},crosshair:{vertLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},priceScale:{autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,position:"right",borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,scaleMargins:{bottom:.1,top:.2}},timeScale:{rightOffset:0,barSpacing:6,fixLeftEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0},watermark:{color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,text:"",horzAlign:"center",vertAlign:"center"},localization:{locale:navigator.language,dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}};var ws=Object.freeze({version:function(){return"1.1.0-dev+202001201138"},get LineStyle(){return i},get LineType(){return t},get CrosshairMode(){return U},get PriceScaleMode(){return vi},isBusinessDay:pi,isUTCTimestamp:yi,createChart:function(t,i){var n=f(d(t)?document.getElementById(t):t),s=void 0===i?b(ds):c(b(ds),i);return new vs(n,s)}});window.LightweightCharts=ws}();
